'use strict';window.tsfem_e_monitor={nonce:tsfem_e_monitorL10n.nonce,i18n:tsfem_e_monitorL10n.i18n,rDataTimeout:tsfem_e_monitorL10n.remote_data_timeout,rCrawlTimeout:tsfem_e_monitorL10n.remote_crawl_timeout,showReadMore:function(a){let b=jQuery("#"+a.target.id+"-wrap"),c=jQuery("#"+a.target.id+"-content");b.remove(),c.slideDown(500)},requestCrawl:function(a){let b=jQuery(a.target);if(b.prop("disabled"))return;let c="#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax";b.addClass("tsfem-button-disabled tsfem-button-loading"),b.prop("disabled",!0),tsfem.resetAjaxLoader("#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax"),tsfem.setAjaxLoader("#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax"),jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_crawl",nonce:tsfem_e_monitor.nonce,remote_crawl_timeout:tsfem_e_monitor.rCrawlTimeout},timeout:1e4,async:!0}).done(function(a){a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let b=a&&a.data||void 0,d=a&&a.type||void 0;if(!b)tsfem.updatedResponse(c,0,tsfem.i18n.InvalidResponse,0);else{"undefined"!=typeof b.status.timeout&&(tsfem_e_monitor.rCrawlTimeout=b.status.timeout);let a=b.status.type,d=b.status.code,e=b.status.notice;"success"===a?(tsfem.updatedResponse(c,1,"",0),tsfem.setTopNotice(d,e)):"yield_unchanged"===a?tsfem.updatedResponse(c,2,e,0):"requires_fix"===a?(tsfem_e_monitor.addRequiresFix(b.status.requires_fix),tsfem.updatedResponse(c,0,"",0),tsfem.setTopNotice(d,e)):(tsfem.updatedResponse(c,0,"",0),tsfem.setTopNotice(d,e))}}).fail(function(a,b,d){let e=tsfem.getAjaxError(a,b,d);tsfem.updatedResponse(c,0,e,0)}).always(function(){b.removeClass("tsfem-button-disabled tsfem-button-loading"),b.prop("disabled",!1)})},fetchData:function(a){let b=jQuery(a.target);if(b.prop("disabled"))return;let c="#tsfem-e-monitor-issues-pane .tsfem-pane-header .tsfem-ajax";b.addClass("tsfem-button-disabled tsfem-button-loading"),b.prop("disabled",!0),tsfem.resetAjaxLoader("#tsfem-e-monitor-issues-pane .tsfem-pane-header .tsfem-ajax"),tsfem.setAjaxLoader("#tsfem-e-monitor-issues-pane .tsfem-pane-header .tsfem-ajax");let d=document.getElementById("tsfem-e-monitor-last-crawled"),e=d.classList.contains("tsfem-success")?"tsfem-success":"tsfem-error";d.classList.remove("tsfem-success"),d.classList.remove("tsfem-error"),d.classList.add("tsfem-loading"),tsfem_e_monitor.setSettingsLoader(),jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_fetch",nonce:tsfem_e_monitor.nonce,remote_data_timeout:tsfem_e_monitor.rDataTimeout},timeout:15e3,async:!0}).done(function(a){a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let b=a&&a.data||void 0,d=a&&a.type||void 0;if(!b||!b.status)tsfem.updatedResponse(c,0,tsfem.i18n.InvalidResponse,0);else{"undefined"!=typeof b.status.timeout&&(tsfem_e_monitor.rDataTimeout=b.status.timeout);let a=b.status.type,d=b.status.content,e=b.status.code,f=b.status.notice;if("success"===a){let a=d.issues,b=d.lc,e=d.settings;if("undefined"!=typeof e)for(let a in e)e.hasOwnProperty(a)&&tsfem_e_monitor.setSetting(a,e[a],!0);a.found?(jQuery(".tsfem-e-monitor-issues-wrap").empty().css("opacity",0).append(a.data.wrap).animate({opacity:1},{queue:!0,duration:250}),jQuery.each(a.data.info,function(a,b){setTimeout(function(){jQuery(b).appendTo(".tsfem-e-monitor-issues-wrap > div").css("opacity",0).animate({opacity:1},{queue:!1,duration:250})},250*a)})):jQuery(".tsfem-e-monitor-issues-wrap").empty().css("opacity",0).append(a.data).animate({opacity:1},{queue:!0,duration:1e3}),jQuery("#tsfem-e-monitor-last-crawled").replaceWith(jQuery(b).css("opacity",0)),jQuery("#tsfem-e-monitor-last-crawled").animate({opacity:1},{queue:!0,duration:1e3}),setTimeout(function(){tsfem.updatedResponse(c,1,f,0)},1e3),tsfTT.triggerReset()}else"yield_unchanged"===a?tsfem.updatedResponse(c,2,f,0):"requires_fix"===a?(tsfem_e_monitor.addRequiresFix(),tsfem.updatedResponse(c,0,"",0),tsfem.setTopNotice(e,f)):(tsfem.updatedResponse(c,0,"",0),tsfem.setTopNotice(e,f))}}).fail(function(a,b,d){let e=tsfem.getAjaxError(a,b,d);tsfem.updatedResponse(c,0,e,0)}).always(function(){document.body.contains(d)&&(d.classList.remove("tsfem-loading"),d.classList.add(e)),tsfem_e_monitor.unsetSettingsLoader(),b.removeClass("tsfem-button-disabled tsfem-button-loading"),b.prop("disabled",!1)})},addRequiresFix:function(){0<jQuery(".tsfem-account-fix").length||1>jQuery(".tsfem-account-info").length||jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_get_requires_fix",nonce:tsfem_e_monitor.nonce},timeout:7e3,async:!0}).done(function(a){a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let b=a&&a.data||void 0,c=a&&a.type||void 0;b&&b.html&&jQuery(b.html).insertAfter(".tsfem-account-info").hide().slideDown(500)}).fail(function(a,b,c){tsfem.debug&&(console.log(a.responseText),console.log(c))})},setSettingsLoader:function(){let a=document.querySelectorAll(".tsfem-e-monitor-edit");for(let b=0;b<a.length;b++)a[b].classList.remove("tsfem-edit"),a[b].classList.remove("tsfem-dashicon-fadeout-3000"),a[b].classList.add("tsfem-loading")},unsetSettingsLoader:function(){let a=document.querySelectorAll(".tsfem-e-monitor-edit");for(let b=0;b<a.length;b++)tsfem_e_monitor.animateResetClicker(a[b])},setSetting:function(a,b,c){c=c||!1;let d,e=document.querySelector(".tsfem-e-monitor-settings-holder[data-option-id=\""+a+"\"]"),f=e&&e.querySelector(".tsfem-e-monitor-edit"),g="";if(!f)return void tsfem.setTopNotice(1011800);"for"in f.dataset&&(g=f.dataset.for),d=g&&document.getElementById(g);d&&(d.value=b,f.innerHTML=d.options[d.selectedIndex].text,c&&tsfem_e_monitor.animateResetClicker(f))},animateResetClicker:function(a){a.classList.contains("tsfem-dashicon-fadeout-3000")||a.classList.contains("tsfem-edit")||(a.classList.remove("tsfem-loading"),a.classList.contains("tsfem-success")||a.classList.contains("tsfem-error")||a.classList.contains("tsfem-unknown")?(a.classList.add("tsfem-dashicon-fadeout-3000"),setTimeout(function(){a.classList.remove("tsfem-success"),a.classList.remove("tsfem-error"),a.classList.remove("tsfem-dashicon-fadeout-3000"),a.classList.add("tsfem-edit")},3e3)):a.classList.add("tsfem-edit"))},editSetting:function(a){let b,c,d=a.target,e=0,f="",g=0,h="",i="";if(d.classList.contains("tsfem-loading"))return!1;if("for"in d.dataset&&(b=d.dataset.for),!b)return!1;if(c=document.getElementById(b),!c)return!1;e=c.value,f=d.innerHTML;const j=function(){const a=function(){d.classList.remove("tsfem-loading"),d.classList.add("tsfem-error")},b=function(){d.classList.remove("tsfem-loading"),d.classList.add("tsfem-success")};r(),m();let c=0,e=0,f="";tsfem.resetAjaxLoader("#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax"),tsfem.setAjaxLoader("#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax"),tsfem_e_monitor.setSettingsLoader(),d.innerHTML=h,jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_update",nonce:tsfem_e_monitor.nonce,option:i,value:g},timeout:15e3,async:!0}).done(function(d){d=tsfem.convertJSONResponse(d),tsfem.debug&&console.log(d);let g=d&&d.data||void 0,h=d&&d.type||void 0;if(!g||!h)f=tsfem.i18n.UnknownError,k(),a();else{let d=g.results&&g.results.code||void 0,h=g.results&&g.results.success||void 0;switch(f=g.results&&g.results.notice||void 0,h?b():a(),d){case 1010805:c=1;break;case 1010804:e=d,c=2;break;default:case 1010801:case 1010802:case 1010803:case 1019002:case 1010702:f=tsfem.i18n.UnknownError,e=d||!1,c=0;}if("undefined"!=typeof g.settings)for(let a in g.settings)g.settings.hasOwnProperty(a)&&tsfem_e_monitor.setSetting(a,g.settings[a],!1)}}).fail(function(b,c,d){k(),a(),f=tsfem.getAjaxError(b,c,d),tsfem.setTopNotice(1011700),d&&tsfem.setTopNotice(-1,"jQ error: "+d)}).always(function(){tsfem.updatedResponse("#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax",c,f,0),e&&tsfem.setTopNotice(e,""),tsfem_e_monitor.unsetSettingsLoader()})},k=function(){d.innerHTML=f,c.value=e},l=function(){jQuery(d).hide(),jQuery(c).slideDown(200).focus()},m=function(){jQuery(c).blur().hide(),jQuery(d).fadeIn(300)},n=function(a){let b=a.target;g=b.value,h=b.options[b.selectedIndex].text,i=b.name,g==e&&p()||j()},o=function(a){let b=jQuery(a.target).closest(c);1>b.length&&p()},p=function(){return r(),m(),!0},q=function(){c.addEventListener("blur",p),c.addEventListener("change",n),window.addEventListener("click",o)},r=function(){c.removeEventListener("blur",p),c.removeEventListener("change",n),window.removeEventListener("click",o)};l(),setTimeout(q,10)},a11yEditSetting:function(a){32==a.which&&(a.preventDefault(),tsfem_e_monitor.editSetting(a))},ready:function(a){a("#tsfem-e-monitor-privacy-readmore").on("click",tsfem_e_monitor.showReadMore),a("#tsfem-e-monitor-crawl-button").on("click",tsfem_e_monitor.requestCrawl),a("#tsfem-e-monitor-fetch-button").on("click",tsfem_e_monitor.fetchData),a(".tsfem-e-monitor-edit").on("click",tsfem_e_monitor.editSetting),a(".tsfem-e-monitor-edit").on("keypress",tsfem_e_monitor.a11yEditSetting)}},jQuery(tsfem_e_monitor.ready);
