'use strict';window.tsfem_e_monitor={nonce:tsfem_e_monitorL10n.nonce,i18n:tsfem_e_monitorL10n.i18n,rDataTimeout:tsfem_e_monitorL10n.remote_data_timeout,rCrawlTimeout:tsfem_e_monitorL10n.remote_crawl_timeout,showReadMore:function(a){let b=jQuery('#'+a.target.id+'-wrap'),c=jQuery('#'+a.target.id+'-content');b.remove(),c.slideDown(500)},requestCrawl:function(a){let b=jQuery(a.target);if(!b.prop('disabled')){let c='tsfem-button-disabled tsfem-button-loading',d='#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax';b.addClass(c),b.prop('disabled',!0),tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d),jQuery.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_e_monitor_crawl',nonce:tsfem_e_monitor.nonce,remote_crawl_timeout:tsfem_e_monitor.rCrawlTimeout},timeout:1e4,async:!0}).done(function(f){f=tsfem.convertJSONResponse(f),tsfem.debug&&console.log(f);let g=f&&f.data||void 0,h=f&&f.type||void 0;if(!g)tsfem.updatedResponse(d,0,tsfem.i18n.InvalidResponse,0);else{'undefined'!=typeof g.status.timeout&&(tsfem_e_monitor.rCrawlTimeout=g.status.timeout);let j=g.status.type,k=g.status.notice;'success'===j?tsfem.updatedResponse(d,1,k,0):'yield_unchanged'===j?tsfem.updatedResponse(d,2,k,0):'requires_fix'===j?(tsfem_e_monitor.addRequiresFix(g.status.requires_fix),tsfem.updatedResponse(d,0,k,0)):tsfem.updatedResponse(d,0,k,0)}}).fail(function(f,g,h){let j=tsfem.getAjaxError(f,g,h);tsfem.updatedResponse(d,0,j,0)}).always(function(){b.removeClass(c),b.prop('disabled',!1)})}},fetchData:function(a){let b=jQuery(a.target);if(!b.prop('disabled')){let c='tsfem-button-disabled tsfem-button-loading',d='#tsfem-e-monitor-issues-pane .tsfem-pane-header .tsfem-ajax, #tsfem-e-monitor-stats-pane .tsfem-pane-header .tsfem-ajax';b.addClass(c),b.prop('disabled',!0),tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d);let f=document.getElementById('tsfem-e-monitor-last-crawled'),g=f.classList.contains('tsfem-success')?'tsfem-success':'tsfem-error';f.classList.remove('tsfem-success'),f.classList.remove('tsfem-error'),f.classList.add('tsfem-loading'),tsfem_e_monitor.setSettingsLoader(),jQuery.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_e_monitor_fetch',nonce:tsfem_e_monitor.nonce,remote_data_timeout:tsfem_e_monitor.rDataTimeout},timeout:15000,async:!0}).done(function(h){h=tsfem.convertJSONResponse(h),tsfem.debug&&console.log(h);let j=h&&h.data||void 0,k=h&&h.type||void 0;if(!j||!j.status)tsfem.updatedResponse(d,0,tsfem.i18n.InvalidResponse,0);else{'undefined'!=typeof j.status.timeout&&(tsfem_e_monitor.rDataTimeout=j.status.timeout);let l=j.status.type,m=j.status.content,n=j.status.notice;if('success'===l){let o=m.issues,p=m.stats,q=m.lc,r=m.settings;if('undefined'!=typeof r)for(let s in r)r.hasOwnProperty(s)&&tsfem_e_monitor.setSetting(s,r[s],!0);if(o.found)jQuery('.tsfem-e-monitor-issues-wrap').empty().css('opacity',0).append(o.data.wrap).animate({opacity:1},{queue:!0,duration:250},'swing'),jQuery.each(o.data.info,function(s,t){setTimeout(function(){jQuery(t).appendTo('.tsfem-e-monitor-issues-wrap > div').css('opacity',0).animate({opacity:1},{queue:!1,duration:250},'swing')},250*s)});else{let s='<div class="tsfem-pane-inner-wrap tsfem-e-monitor-issues-wrap">'+o.data+'</div>';jQuery('.tsfem-e-monitor-issues-wrap').empty().css('opacity',0).append(s).animate({opacity:1},{queue:!0,duration:1e3},'swing')}jQuery('#tsfem-e-monitor-last-crawled').replaceWith(jQuery(q).css('opacity',0)),jQuery('#tsfem-e-monitor-last-crawled').animate({opacity:1},{queue:!0,duration:1e3},'swing'),jQuery('.tsfem-e-monitor-stats-wrap').empty().css('opacity',0).append(p).animate({opacity:1},{queue:!0,duration:1e3},'swing'),setTimeout(function(){tsfem.updatedResponse(d,1,n,0)},1e3),tsfem.initDescHover()}else'yield_unchanged'===l?tsfem.updatedResponse(d,2,n,0):'requires_fix'===l?(tsfem_e_monitor.addRequiresFix(),tsfem.updatedResponse(d,0,n,0)):tsfem.updatedResponse(d,0,n,0)}}).fail(function(h,j,k){let l=tsfem.getAjaxError(h,j,k);tsfem.updatedResponse(d,0,l,0)}).always(function(){document.body.contains(f)&&(f.classList.remove('tsfem-loading'),f.classList.add(g)),tsfem_e_monitor.unsetSettingsLoader(),b.removeClass(c),b.prop('disabled',!1)})}},addRequiresFix:function(){0<jQuery('.tsfem-account-fix').length||1>jQuery('.tsfem-account-info').length||jQuery.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_e_monitor_get_requires_fix',nonce:tsfem_e_monitor.nonce},timeout:3e3,async:!0}).done(function(a){a=tsfem.convertJSONResponse(a),tsfem.debug&&console.log(a);let b=a&&a.data||void 0,c=a&&a.type||void 0;b&&b.html&&jQuery(b.html).insertAfter('.tsfem-account-info').hide().slideDown(500)}).fail(function(a,b,c){tsfem.debug&&(console.log(a.responseText),console.log(c))})},setSettingsLoader(){let a=document.querySelectorAll('.tsfem-e-monitor-edit');for(let b=0;b<a.length;b++)a[b].classList.remove('tsfem-edit'),a[b].classList.remove('tsfem-dashicon-fadeout-3000'),a[b].classList.add('tsfem-loading')},unsetSettingsLoader:function(){let a=document.querySelectorAll('.tsfem-e-monitor-edit');for(let b=0;b<a.length;b++)tsfem_e_monitor.animateResetClicker(a[b])},setSetting:function(a,b,c){c=c||!1;let d=document.querySelector('.tsfem-e-monitor-settings-holder[data-option-id="'+a+'"]'),f=d&&d.querySelector('.tsfem-e-monitor-edit'),g,h='';if(!f)return void tsfem.setTopNotice(1011800);'for'in f.dataset&&(h=f.dataset.for),g=h&&document.getElementById(h);g&&(g.value=b,f.innerHTML=g.options[g.selectedIndex].text,c&&tsfem_e_monitor.animateResetClicker(f))},animateResetClicker:function(a){a.classList.contains('tsfem-dashicon-fadeout-3000')||a.classList.contains('tsfem-edit')||(a.classList.remove('tsfem-loading'),a.classList.contains('tsfem-success')||a.classList.contains('tsfem-error')||a.classList.contains('tsfem-unknown')?(a.classList.add('tsfem-dashicon-fadeout-3000'),setTimeout(function(){a.classList.remove('tsfem-success'),a.classList.remove('tsfem-error'),a.classList.remove('tsfem-dashicon-fadeout-3000'),a.classList.add('tsfem-edit')},3e3)):a.classList.add('tsfem-edit'))},editSetting:function(a){let c,d,b=a.target,f=0,g='',h=0,j='',k='';if(b.classList.contains('tsfem-loading'))return!1;if('for'in b.dataset&&(c=b.dataset.for),!c)return!1;if(d=document.getElementById(c),!d)return!1;f=d.value,g=b.innerHTML;const l=function(){const u=function(){b.classList.remove('tsfem-loading'),b.classList.add('tsfem-error')},v=function(){b.classList.remove('tsfem-loading'),b.classList.add('tsfem-success')};t(),o();let w='#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax',x=0,z=0,A='';tsfem.resetAjaxLoader(w),tsfem.setAjaxLoader(w),tsfem_e_monitor.setSettingsLoader(),b.innerHTML=j,jQuery.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_e_monitor_update',nonce:tsfem_e_monitor.nonce,option:k,value:h},timeout:15000,async:!0}).done(function(B){B=tsfem.convertJSONResponse(B),tsfem.debug&&console.log(B);let C=B&&B.data||void 0,D=B&&B.type||void 0;if(!C||!D)A=tsfem.i18n.UnknownError,m(),u();else{let E=C.results&&C.results.code||void 0,F=C.results&&C.results.success||void 0;switch(A=C.results&&C.results.notice||void 0,F?v():u(),E){case 1010805:x=1;break;case 1010804:z=E,x=2;break;default:case 1010801:case 1010802:case 1010803:case 1019002:case 1010702:A=tsfem.i18n.UnknownError,z=E||!1,x=0;}if('undefined'!=typeof C.settings)for(let G in C.settings)C.settings.hasOwnProperty(G)&&tsfem_e_monitor.setSetting(G,C.settings[G],!1)}}).fail(function(B,C,D){m(),u(),A=tsfem.getAjaxError(B,C,D),tsfem.setTopNotice(1011700),D&&tsfem.setTopNotice(-1,'jQ error: '+D)}).always(function(){tsfem.updatedResponse(w,x,A,0),z&&tsfem.setTopNotice(z,''),tsfem_e_monitor.unsetSettingsLoader()})},m=function(){b.innerHTML=g,d.value=f},o=function(){jQuery(d).hide(),jQuery(b).fadeIn(300)},p=function(u){let v=u.target;h=v.value,j=v.options[v.selectedIndex].text,k=v.name,h==f&&r()||l()},q=function(u){let v=jQuery(u.target).closest(d);1>v.length&&r()},r=function(){return o(),t(),!0},t=function(){window.removeEventListener('click',q),d.removeEventListener('change',p)};(function(){jQuery(b).hide(),jQuery(d).slideDown(200)})(),setTimeout(function(){window.addEventListener('click',q),d.addEventListener('change',p)},10)},ready:function(a){a('#tsfem-e-monitor-privacy-readmore').on('click',tsfem_e_monitor.showReadMore),a('#tsfem-e-monitor-crawl-button').on('click',tsfem_e_monitor.requestCrawl),a('#tsfem-e-monitor-fetch-button').on('click',tsfem_e_monitor.fetchData),a('.tsfem-e-monitor-edit').on('click',tsfem_e_monitor.editSetting)}},jQuery(tsfem_e_monitor.ready);
