'use strict';window.tsfem_e_import=function(){const a=tsfem_e_transportL10n,b=a=>{a||=!1,["importer-submit"].forEach(b=>{const c=document.getElementById(`tsfem-e-transport-${b}`);c.classList.toggle("tsfem-button-disabled",a),c.disabled=a})},c=()=>b(!0),d=(a,b,c)=>{const d="#tsfem-e-transport-log-ajax";switch(a||"start"){case"start":tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d);break;case"end":tsfem.updatedResponse(d,b,c);}},e=e=>{const f=e.target;if(f.disabled)return;let i=["tsfem-button-loading"];f.classList.add(...i),c(),d(),k();const j="tsfem-e-transport-importer",m=document.getElementById(j),n=new FormData(m);[...n.keys()].forEach(a=>{m.querySelectorAll(`[name="[${a}]"]`).forEach(a=>{a.dataset.handlerDisabled=!a.disabled,a.disable=!0})});const o="undefined"==typeof EventSource?h:g;o("import",n,new Date().toLocaleTimeString()+" :: "+a.i18n.logMessages.requestImport.replace("%s",m.querySelector(`[value="${n.get(`${j}[choosePlugin]`)}"]`)?.dataset.title)).then(a=>{d("end",1,a)}).catch(a=>{d("end",0,a)}).finally(()=>{b(),f.classList.remove(...i),[...n.keys()].forEach(a=>{m.querySelectorAll(`[name="${a}"]`).forEach(a=>{a.dataset.handlerDisabled&&(a.disabled=!1),delete a.dataset.handlerDisabled})}),l()})},f="tsfem_e_transporter_sse",g=(b,c,d)=>new Promise(async(e,g)=>(await(tsfem_worker.getWorker(f)||tsfem_worker.spawnWorker(a.scripts.sseWorker,f)),tsfem_worker.isWorkerBusy(f)?g("Worker busy."):void(tsfem_worker.occupyWorker(f),tsfem_worker.assignWorker(f,{handle:b,formData:c&&new URLSearchParams([...c.entries()]).toString(),logStart:d,urlData:{endpoint:ajaxurl,base:new URL(document.baseURI).origin},nonce:a.nonce,logMessages:a.i18n.logMessages},a=>"log"in a.data?j(a.data.log):"reject"in a.data?(tsfem_worker.despawnWorker(f),g(a.data.reject)):"resolve"in a.data?(tsfem_worker.freeWorker(f),e(a.data.resolve)):void 0,a=>{tsfem_worker.despawnWorker(f),g(a?.message)})))),h=(b,c,d)=>new Promise((e,f)=>{j(d,1),wp.ajax.post("tsfem_e_transport",{handle:b,nonce:a.nonce,data:c&&new URLSearchParams([...c.entries()]).toString()}).done(a=>{e(a?.results?.notice),j(a?.logMsg,2)}).fail(a=>{f(a.data?.results?.notice),j(a.data?.logMsg,2)})}),i=document.getElementById("tsfem-e-transport-logger"),j=(a,b)=>{i&&a?.length&&tsfem_ui.logger.queue(i,`\n&ratio; ${a}${"\n".repeat(b||0)}`)},k=()=>i&&tsfem_ui.logger.start(i),l=()=>i&&tsfem_ui.logger.stop(i),m=a=>{if(!i)return;const b=()=>setTimeout(()=>{tsfTT.removeTooltip(a.target)},3e3);tsfem_ui.logger.copy(i).then(()=>{tsfTT.doTooltip(a,a.target,a.target.dataset.copyconfirm),b()}).catch(()=>{tsfTT.doTooltip(a,a.target,a.target.dataset.copyfail),b()})},n=()=>i&&tsfem_ui.logger.scrollToBottom(i),o=b=>{if(b.preventDefault(),b.stopPropagation(),b.target.dataset?.lastValue===b.target.value)return;b.target.dataset.lastValue=b.target.value;const c="tsfem-e-transport-importer",d=JSON.parse(b.target.selectedOptions[0]?.dataset.importers),f=document.getElementById(`${c}-options`),g=document.getElementById(`${c}-supports-transformation-help`),h=document.getElementById(`${c}-submit`);f.innerHTML="",f.style.display="none",g.style.display="none";let i=!1,j=!1,k=!1;const l=()=>{h.disabled=k,h.classList.toggle("tsfem-button-disabled",k)},m=()=>{const a=document.querySelectorAll(`[name^="${c}\\[selectType\\]"]:checked`);i=!1,a.forEach(a=>{i=!!d[a.value]?.transform?.length}),g.style.display=i?null:"none",k=!a.length,l()},n=b=>{const d=document.getElementById(`${c}-options-template`).content.cloneNode(!0),e=d.querySelector(`[name^="${c}\\[selectType\\]"]`);d.querySelector(`.${c}-selectType-description`).innerText=a.i18n.optionNames[b]??"",e.value=b,e.addEventListener("change",m),f.appendChild(d)};d.postmeta&&(n("postmeta"),j=!0),d.termmeta&&(n("termmeta"),j=!0),j?(f.style.display=null,m()):(k=!0,l()),h.addEventListener("click",e)},p=()=>{const a=document.getElementById("tsfem-e-transport-importer[choosePlugin]");a.addEventListener("change",o),a.dispatchEvent(new Event("change")),document.getElementById("tsfem-e-transport-copy-log")?.addEventListener("click",m),document.getElementById("tsfem-e-transport-scroll-log")?.addEventListener("click",n)};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",p)}})}(),window.tsfem_e_import.load();
