'use strict';window.tsfem_e_focus_inpost=function(c){const d=tsfem_e_focusInpostL10n,f='#tsfem-e-focus-analysis-notification-area';var g={},h={},j={};const k=Y=>{return(/.*\[[0-9]+\]/.exec(Y)||'')[0]},l=(Y,Z)=>{return Y+'['+Z+']'},m=(Y,Z)=>{return document.getElementById(Y+'['+Z+']')},n=Y=>{return Object.keys(Y).sort((Z,_)=>{return Object.keys(Z)[0]-Object.keys(_)[0]}),Y},o=(Y,Z)=>{if(Y&&Y===Object(Y)){let _=g;Z=!!Z;let aa,ba;for(let ca in Y)for(let da in aa=Y[ca],_[ca]||(_[ca]={}),aa)if(ba=aa[da],_[ca][ba]||(_[ca][ba]=[]),Z){let ea=Object.keys(_[ca][ba]).map(fa=>_[ca][ba][fa]);if(-1<ea.indexOf(da))continue;_[ca][ba].push(da)}else _[ca][ba]=_[ca][ba].filter(ea=>ea!==da);g=_}},p=Y=>{const Z=g;let _=h,aa={},ba=!1,ca='',da=[];const ea=ga=>{aa=Z[ga],ba=!1,ca='',da=[],'undefined'!=typeof aa.dominate&&aa.dominate.forEach(ha=>{document.querySelector(ha)&&(ba=!0,ca=ha)}),ba||'undefined'==typeof aa.append||aa.append.forEach(ha=>{document.querySelector(ha)&&da.push(ha)}),ba?_[ga]=[ca]:da.length?_[ga]=da:fa(ga)},fa=ga=>{delete _[ga]};if(Y)'undefined'==typeof Z[Y]?fa(Y):ea(Y);else{for(var ga in Z)ea(ga)}h=_},q=Y=>{let ea,Z=c(Y).data('scores'),_=0,aa=0,ba=0,ca=0,da=0,fa=Z.assessment.regex;fa!==Object(fa)&&(fa=[fa]);let ga=k(Y.id),ha=M(ga).get('inflections'),ia=M(ga).get('synonyms');const ja=qa=>{return qa=qa.match(/[^>]+(?=<|$|^)/gi),qa&&qa.join('').length||0},ka=(qa,ra)=>{let sa,ta=tsfem_inpost.bewilderRegexNonWords(tsfem_inpost.escapeRegex(tsfem_inpost.escapeStr(qa,!0)));for(let ua=0;ua<fa.length&&(sa=/\/(.*)\/(.*)/.exec(fa[ua]),ra=ra.match(new RegExp(sa[1].replace(/\{\{kw\}\}/g,ta),sa[2])),ra&&ua!==fa.length-1);ua++)ra=ra.join(' ');return ra&&ra.length||0},la=(qa,ra)=>ra.replace(new RegExp(tsfem_inpost.escapeRegex(tsfem_inpost.escapeStr(qa,!0)),'gi'),'/'),ma=qa=>{let ra=ha,sa=qa;return ra.length&&ra.sort((ta,ua)=>ua.length-ta.length),tsfem_inpost.promiseLoop(ra,ta=>{let ua=ka(ta,sa);_+=ua,ba+=ta.length*ua,sa=la(ta,sa)},5)},na=qa=>{let ra=ia,sa=qa;return ra.length&&ra.sort((ta,ua)=>ua.length-ta.length),tsfem_inpost.promiseLoop(ra,ta=>{let ua=ka(ta,sa);aa+=ua,ca+=ta.length*ua,sa=la(ta,sa)},5)};c.when(tsfem_inpost.promiseLoop(h[Z.assessment.content],qa=>{let ra=document.querySelector(qa),sa=c.Deferred();return(ea='undefined'==typeof ra.value?'':ra.value,ea.length||(ea=ra.innerHTML),!ea.length)?sa.resolve():(ea=tsfem_inpost.normalizeSpacing(ea).trim(),!ea.length)?sa.resolve():(da+=ja(ea),c.when(ma(ea),na(ea)).done(()=>{sa.resolve()}),sa.promise())},5)).done(()=>{let qa=Z.scoring,ra=0,sa=0;const ta=(Ba,Ca)=>Ca>Ba?Ba:Ca,ua=(Ba,Ca)=>Math.floor(Ca/Ba.per)*Ba.score,va=(Ba,Ca)=>Ca*(Ba/100),wa=(Ba,Ca)=>100*(Ca/Ba),xa=(Ba,Ca)=>Ca/Ba.threshold*Z.maxScore;switch(qa.type){case'n':_&&(sa+=ua(qa.keyword,ta(qa.keyword.max,_))),aa&&(sa+=ua(qa.synonym,ta(qa.synonym.max,aa)));break;case'p':da&&(ba&&(ra+=wa(da,va(qa.keyword.weight,ba))),ca&&(ra+=wa(da,va(qa.synonym.weight,ca)))),sa=xa(qa,ra);}let ya=document.querySelector('input[name="'+Y.id+'"]');ya&&(ya.value=sa);let za=Y.querySelector('.tsfem-e-focus-assessment-description'),Aa=r(Z.phrasing,sa);za.innerHTML===Aa?(tsfem_inpost.setIconClass(Y.querySelector('.tsfem-e-focus-assessment-rating'),t(Z.rating,sa)),za.style.opacity='1',za.style.willChange='auto'):(za.style.willChange='contents, opacity',za.style.opacity='0',za.innerHTML=Aa,tsfem_inpost.setIconClass(Y.querySelector('.tsfem-e-focus-assessment-rating'),t(Z.rating,sa)),tsfem_inpost.fadeIn(za),za.style.willChange='auto')})},r=(Y,Z)=>{let _;for(let aa in Y=n(Y),Y)if(isFinite(aa)&&!isNaN(parseFloat(aa)))if(aa<=Z)_=Y[aa];else break;return _?_:Y[Object.keys(Y)[0]]},t=(Y,Z)=>{let _=r(Y,Z).toString(),aa={0:'unknown',1:'bad',2:'warning',3:'okay',4:'good','-1':'error'};return'undefined'!=typeof aa[_]&&aa[_]||aa['-1']},u=Y=>{let Z=m(Y,'keyword').value,_=m(Y,'lexical_form');if(!(!_ instanceof HTMLInputElement)){E(Y).to('loading');const aa=ca=>{let da=m(Y,'lexical_selector'),ea=m(Y,'lexical_data'),fa=JSON.parse(d.defaultLexicalForm);fa=Object.keys(fa).map(ha=>fa[ha]),ca.length&&(ca.forEach(ha=>{ha.inflection&&ha.category&&fa.push({value:ha.inflection,category:ha.category,name:ha.category+': '+ha.inflection})}),A(Y).to('enabled'));let ga=fa.length&&JSON.stringify(fa)||d.defaultLexicalForm;_.value='',ea instanceof HTMLInputElement&&(ea.value=ga),da instanceof HTMLSelectElement&&(w(Y,ga),da.disabled=!1,da.selectedIndex=0)};c.when(((ca,da)=>{let ea={method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_e_focus_get_lexicalforms',nonce:d.nonce,post_ID:tsfem_inpost.postID,args:{keyword:da,language:'en'}},timeout:15000,async:!0},fa=c.Deferred();return tsfem_inpost.doAjax(fa,ea,{noticeArea:f,premium:!0}),fa.promise()})(Y,Z)).done(ca=>{aa(ca.forms)}).fail(()=>{v(Y,'lexical')}).always(()=>{E(Y).to('edit')})}},v=(Y,Z)=>{const _=()=>{let ea=m(Y,'lexical_form'),fa=m(Y,'lexical_selector'),ga=m(Y,'lexical_data');ea instanceof HTMLInputElement&&(ea.value=''),ga instanceof HTMLInputElement&&(ga.value=d.defaultLexicalForm),fa instanceof HTMLSelectElement&&(fa.disabled=!0,fa.selectedIndex=0,fa.dataset.prev=0,w(Y,d.defaultLexicalForm)),E(Y).to('unchecked')},aa=()=>{let ea=m(Y,'definition_dropdown'),fa=m(Y,'definition_selection');ea instanceof HTMLSelectElement&&(ea.selectedIndex=0,ea.innerHTML='',document.querySelector('[data-for="'+ea.id+'"]').innerHTML=''),fa instanceof HTMLInputElement&&(fa.value=''),M(Y).clearCache()},ba=()=>{let ea=m(Y,'inflections'),fa=ea&&ea.querySelector('.tsfem-e-focus-subject-selection'),ga=m(Y,'inflection_data'),ha=m(Y,'active_inflections');fa instanceof Element&&(fa.innerHTML=''),ga instanceof HTMLInputElement&&(ga.value=''),ha instanceof HTMLInputElement&&(ha.value=''),M(Y).clearCache('inflections')},ca=()=>{let ea=m(Y,'synonyms'),fa=ea&&ea.querySelector('.tsfem-e-focus-subject-selection'),ga=m(Y,'synonym_data'),ha=m(Y,'active_synonyms');fa instanceof Element&&(fa.innerHTML=''),ga instanceof HTMLInputElement&&(ga.value=''),ha instanceof HTMLInputElement&&(ha.value=''),M(Y).clearCache('synonyms'),tsfem_inpost.isPremium&&K(Y)},da=()=>{m(Y,'scores').querySelectorAll('input').forEach(ea=>ea.value=0)};switch(Z){case'lexical':_(),aa();break;case'definition':aa();break;case'inflections':ba();break;case'synonyms':ca();break;case'ratings':da();break;default:_(),aa(),ba(),ca(),da();}},w=(Y,Z)=>{let _=m(Y,'lexical_selector');for(let ca=_.options.length;ca--;)_.remove(ca);let aa=document.createElement('option'),ba=JSON.parse(Z);if(ba)for(let ca in ba)aa=aa.cloneNode(),aa.value=tsfem_inpost.escapeStr(ca),aa.innerHTML=tsfem_inpost.escapeStr(ba[ca].name),_.appendChild(aa)};var x={};const y=Y=>{let Z=Y.data.idPrefix,_=m(Z,'lexical_selector'),aa=m(Z,'lexical_form'),ba=m(Z,'lexical_data');const ca=()=>{let ia=JSON.parse(ba.value),ja=ia[aa.value],ka={method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_e_focus_get_synonyms',nonce:d.nonce,post_ID:tsfem_inpost.postID,args:{form:ja,language:'en'}},timeout:15000,async:!0},la=c.Deferred();return tsfem_inpost.doAjax(la,ka,{noticeArea:f,premium:!0}),la.promise()},da=ha=>{aa.value=ha,_.value=ha,_.selectedIndex=+ha},ea=()=>{v(Z,'inflections');let ha=m(Z,'keyword').value.toLowerCase(),ia=aa.value,ja=ba.value,ka='',la=[];return ka=JSON.parse(ja)[ia].value.toLowerCase(),la.push(ha),ha!==ka&&la.push(ka),m(Z,'inflection_data').value=JSON.stringify([{inflections:la}]),c.Deferred().resolve()},fa=()=>{let ha=c.Deferred();return c.when(ca(Z)).done(ia=>{v(Z,'definition'),v(Z,'synonyms'),_.dataset.prev=_.value,m(Z,'synonym_data').value=JSON.stringify(ia.synonyms),ha.resolve()}).fail(ia=>{1100202===ia||1100205===ia?(v(Z,'definition'),v(Z,'synonyms'),_.dataset.prev=_.value,m(Z,'synonym_data').value='',ha.resolve()):(da(_.dataset.prev||0),ha.reject())}),ha.promise()};(()=>{E(Z).to('loading'),clearTimeout(x[Z]),x[Z]=setTimeout(()=>{_.dataset.prev==_.value?E(Z).to('edit'):(da(_.value),+_.value?c.when(ea(),fa()).done(()=>{z(Z),K(Z),E(Z).to('enabled, edit, checked')}).fail(()=>{E(Z).to('edit')}):(_.dataset.prev=_.value,E(Z).to('unchecked, disabled, edit'),v(Z,'definition'),v(Z,'inflections'),v(Z,'synonyms')))},1500)})()},z=Y=>{let Z=m(Y,'synonym_data'),_=m(Y,'definition_dropdown'),aa=m(Y,'definition_selection'),ba=_.cloneNode(!0),ca=Z.value&&JSON.parse(Z.value)||{};for(let fa=ba.options.length;fa--;)ba.remove(fa);let da=document.createElement('option');for(let fa=0;fa<ca.length;fa++)da=da.cloneNode(),da.value=fa,da.innerHTML=tsfem_inpost.escapeStr(ca[fa].example),ba.appendChild(da);_.innerHTML=ba.innerHTML,_.value=aa.value,_.selectedIndex=+aa.value;let ea=m(Y,'definition_selector');_.options.length?(c(document.querySelector('[data-for="'+_.id+'"]')).trigger('set-tsfem-e-focus-definition'),ea.style.display=null):ea.style.display='none'},A=Y=>{const Z=aa=>{c(aa).off('change.tsfemInpostLexical').on('change.tsfemInpostLexical',{idPrefix:Y},y)},_=aa=>{c(aa).off('change.tsfemInpostLexical')};return{to:aa=>{let ba=m(Y,'lexical_selector');if(!(!ba instanceof HTMLSelectElement))switch(aa){case'enabled':Z(ba);break;default:case'disabled':_(ba);}}}},B=Y=>{let Z=m(Y,'scores'),_=Z&&Z.querySelectorAll('.tsfem-e-focus-assessment-wrap');if(!_||_!==Object(_))D(Y).to('error');else{D(Y).to('enabled');for(let aa=_.length;aa--;)C(_[aa]);T(Y)}},C=Y=>{let Z=k(Y.id),_=m(Z,'keyword').value;if(_){let aa,ba,ca,da,ea;ba=Y.querySelector('.tsfem-e-focus-assessment-rating'),tsfem_inpost.setIconClass(ba,'loading'),ca=!0,ea='undefined'!=typeof Y.dataset.assess&&!+Y.dataset.assess,aa=c(Y).data('scores'),aa&&aa.hasOwnProperty('assessment')&&'undefined'!=typeof h[aa.assessment.content]&&(Y.dataset.assess=1,O(Y,aa.assessment.content),ca=!1),ca?(tsfem_inpost.setIconClass(ba,'unknown'),Y.dataset.assess=0,da=document.getElementsByName(Y.id),da&&da[0]&&(da[0].value=0),tsfem_inpost.fadeOut(Y,250)):ea&&tsfem_inpost.fadeIn(Y,250)}},D=Y=>{let Z=c(m(Y,'content')),_=['.tsfem-e-focus-scores-wrap','.tsfem-e-focus-no-keyword-wrap','.tsfem-e-focus-something-wrong-wrap'];const aa=ba=>{_.splice(_.indexOf(ba),1),Z.find(_.join(', ')).fadeOut(150,()=>{setTimeout(()=>{Z.find(ba).fadeIn(250)},150)})};return{to:ba=>{let ca;switch(ba){case'disabled':ca='.tsfem-e-focus-no-keyword-wrap';break;case'enabled':ca='.tsfem-e-focus-scores-wrap';break;default:case'error':ca='.tsfem-e-focus-something-wrong-wrap';}aa(ca)}}},E=Y=>{return{to:Z=>{let _=m(Y,'subject_edit');if(_&&!(!_ instanceof HTMLInputElement)){let aa=document.querySelector('label[for="'+_.id+'"]'),ba=_.parentNode,ca='tsfem-e-focus-edit-subject-button-wrap-disabled';Z.split(',').forEach(da=>{switch(da.trim()){case'checked':_.checked||(_.checked=!0,c(_).trigger('change'));break;case'unchecked':_.checked&&(_.checked=!1,c(_).trigger('change'));break;case'loading':aa&&tsfem_inpost.setIconClass(aa,'loading');break;case'edit':aa&&tsfem_inpost.setIconClass(aa,'edit');break;case'enabled':_.disabled=!1,ba.classList.add(ca),ba.classList.remove(ca);break;case'disabled':_.disabled=!0,ba.classList.remove(ca),ba.classList.add(ca);break;default:}})}}}},F=()=>{c('.tsfem-e-focus-collapse-header').off('dblclick.tsfem-e-focus').on('dblclick.tsfem-e-focus',Z=>{if(!tsfem_inpost.isActionableElement(Z.target)){let _=c(Z.target).closest('.tsfem-e-focus-collapse-wrap'),aa=k(_.attr('id')),ba=m(aa,'collapser');ba instanceof HTMLInputElement&&(ba.checked=!ba.checked)}})},G=()=>{let Y={},Z=1500,_=3,ba={},ca={},da=Z/(100*_);da*=1.175;const ea=(ia,ja)=>{ja.style.width=++ba[ia]/_+'%'},fa=(ia,ja)=>{ba[ia]=0,ja.style.width='0%'};let ga=c('.tsfem-e-focus-keyword-entry');const ha=ia=>{let ja=ia.target,ka=ja.value.trim().replace(/[\s\t\r\n]+/g,' ')||'',la=ja.dataset.prev||'';if(ia.target.value=ka,ka!==la){let ma=k(ia.target.id);return ja.dataset.prev=ka,v(ma),E(ma).to('disabled, edit'),c(m(ma,'scores')).find('.tsfem-e-focus-assessment-description').css('opacity','0'),ka.length?void(tsfem_inpost.isPremium&&d.languageSupported&&u(ma),B(ma)):(D(ma).to('disabled'),void A(ma).to('disabled'))}};ga.off('input.tsfem-e-focus').on('input.tsfem-e-focus',ia=>{let ja=k(ia.target.id),ka=m(ja,'content').querySelector('.tsfem-e-focus-content-loader-bar'),la=m(ja,'collapser');la.checked&&(la.checked=!1,c(la).trigger('change')),clearInterval(ca[ja]),clearTimeout(Y[ja]),fa(ja,ka),ca[ja]=setInterval(()=>ea(ja,ka),da),Y[ja]=setTimeout(()=>{clearInterval(ca[ja]),ha(ia),fa(ja,ka)},Z)}),ga.each((ia,ja)=>{if(!ja.value.length){let ka=k(ja.id);v(ka)}})},H=()=>{const Y=ea=>{let ga,ha,ia,ja,fa=ea.target,ka=0,la='',ma=0,na='',oa=ea.data&&ea.data.change||!1;if('undefined'!=typeof fa.dataset.for&&(ga=fa.dataset.for),!ga)return!1;if(ha=document.getElementById(ga),ja=k(ga),ia=m(ja,'definition_selection'),!ha)return!1;ka=ha.value,la=fa.innerHTML;const pa=()=>{fa.innerHTML=na,ha.value=ma,ia.value=ma,+ma!=+ka&&(m(ja,'active_synonyms').value='',m(ja,'active_inflections').value='',K(ja)),wa()},sa=()=>{c(ha).blur().hide(),c(fa).fadeIn(300)},ta=Aa=>{Aa.target;ua(Aa.target),+ma==+ka&&wa()||pa()},ua=Aa=>{ma=Aa.value,na=Aa.options[Aa.selectedIndex].text},va=Aa=>{let Ba=c(Aa.target).closest(ha);1>Ba.length&&wa()},wa=()=>{return za(),sa(),!0},xa=()=>{ua(ha),pa()},za=()=>{ha.removeEventListener('blur',wa),ha.removeEventListener('change',ta),window.removeEventListener('click',va)};(()=>{c(fa).hide(),c(ha).slideDown(200).focus()})(),setTimeout(()=>{ha.addEventListener('blur',wa),ha.addEventListener('change',ta),window.addEventListener('click',va),oa&&xa()},10)};let aa='click.tsfem-e-focus-definition-editor',ba='keypress.tsfem-e-focus-definition-editor',ca='set-tsfem-e-focus-definition';c('.tsfem-e-focus-definition-editor').off(aa).on(aa,Y).off(ba).on(ba,ea=>{32==ea.which&&(ea.preventDefault(),Y(ea))}).off(ca).on(ca,{change:1},Y);let da='change.tsfem-e-focus-edit-subject-toggle';c('.tsfem-e-focus-edit-subject-checkbox').off(da).on(da,ea=>{let fa=k(ea.target.id),ga=m(fa,'edit'),ha=m(fa,'evaluate'),ia=m(fa,'collapser');ia.checked?(ea.target.checked=!0,ha.style.display='none',ha.style.opacity=0,ga.style.display=null,ga.style.opacity=1,ia.checked=!1):ea.target.checked?tsfem_inpost.fadeOut(ha,150,{cb:()=>{tsfem_inpost.fadeIn(ga,250),ea.target.checked=!0},promise:!1}):tsfem_inpost.fadeOut(ga,150,{cb:()=>{tsfem_inpost.fadeIn(ha,250),ea.target.checked=!1},promise:!1})})};var I={};const J=()=>{const Y=ea=>(/\[([0-9]+)\]$/.exec(ea)||'')[1],Z=ea=>{let fa=m(ea,'inflections'),ga=fa.querySelectorAll('input:checked'),ha=[];ga.forEach(ia=>{ha.push(Y(ia.id))}),m(ea,'active_inflections').value=ha.join(),M(ea).clearCache('inflections'),T(ea)},_=ea=>{let fa=m(ea,'synonyms'),ga=fa.querySelectorAll('input:checked'),ha=[];ga.forEach(ia=>{ha.push(Y(ia.id))}),m(ea,'active_synonyms').value=ha.join(),M(ea).clearCache('synonyms'),T(ea)},aa=ea=>{let fa=ea.data.idPrefix,ga=ea.data.type,ha=fa+ga;clearTimeout(I[ha]),I[ha]=setTimeout(()=>{'inflections'===ga?Z(fa):'synonyms'===ga?_(fa):void 0},1500)},ba=(ea,fa)=>{c(m(ea,fa)).find('input').off('change.tsfem-e-focus').on('change.tsfem-e-focus',{idPrefix:ea,type:fa},aa)};let da='tsfem-e-focus-updated-subject.tsfem-e-focus';c(window).off(da).on(da,(ea,fa)=>{if(fa&&fa.idPrefix){const ga=fa.idPrefix,ha=m(ga,'inflection_data'),ia=m(ga,'synonym_data'),ja=m(ga,'definition_selection'),ka=m(ga,'inflections'),la=m(ga,'synonyms'),ma=ka.querySelector('.tsfem-e-focus-subject-selection'),na=la.querySelector('.tsfem-e-focus-subject-selection'),oa=wp.template('tsfem-e-focus-subject-item');let pa=ha.value&&JSON.parse(ha.value),qa=pa&&pa[0].inflections||{},ra=ia.value&&JSON.parse(ia.value),sa=ra&&ra[+ja.value]&&ra[+ja.value].synonyms||{};ma.style.opacity=0,na.style.opacity=0;let ta=m(ga,'active_inflections').value.split(','),ua=m(ga,'active_synonyms').value.split(','),va='',wa=l(ga,'inflection');for(let xa in qa)va+=oa({id:l(wa,xa),value:qa[xa],checked:!+xa||-1<ta.indexOf(xa+'')?'checked':'',disabled:+xa?'':'disabled'});for(let xa in ma.innerHTML=va,va='',wa=l(ga,'synonym'),sa)va+=oa({id:l(wa,xa),value:sa[xa],checked:-1<ua.indexOf(xa+'')?'checked':''});na.innerHTML=va,qa.length?(ka.style.display=null,tsfem_inpost.fadeIn(ma)):ka.style.display='none',sa.length?(la.style.display=null,tsfem_inpost.fadeIn(na)):la.style.display='none',Z(ga),_(ga),ba(ga,'inflections'),ba(ga,'synonyms')}})},K=Y=>{c(window).trigger('tsfem-e-focus-updated-subject',[{idPrefix:Y}])};var L={};const M=Y=>{M.hasOwnProperty(Y)||(L[Y]={},L[Y].inflections=null,L[Y].synonyms=null);const Z=()=>{let ca,da,ea=m(Y,'active_inflections');if(ea instanceof HTMLInputElement&&ea.value){let fa=m(Y,'inflection_data').value;da=JSON.parse(fa)[0].inflections,ca=[],ea.value.split(',').forEach(ga=>{ca.push(da[+ga])})}if(!ca){let fa=m(Y,'keyword').value;ca=fa&&[fa]||!1}return ca=ca||!1,L[Y].inflections=ca,ca},_=()=>{let ca,da,ea=m(Y,'active_synonyms'),fa=m(Y,'definition_selection');if(ea instanceof HTMLInputElement&&ea.value){let ga=m(Y,'synonym_data').value;da=JSON.parse(ga)[+fa.value].synonyms,ca=[],ea.value.split(',').forEach(ha=>{ca.push(da[+ha])})}return ca=ca||!1,L[Y].synonyms=ca,ca},aa=ca=>{if(null!==L[Y][ca])return L[Y][ca];switch(ca){case'inflections':return Z();break;case'synonyms':return _();break;default:return{inflections:Z(),synonyms:_()};}},ba=ca=>{ca?delete L[Y][ca]:delete L[Y]};return{get:ca=>aa(ca),clearCache:ca=>ba(ca)}},N=(Y,Z)=>{if('undefined'!=typeof j[Y]){Z=Z||'unknown';for(let _=j[Y].length;_--;)tsfem_inpost.setIconClass(document.getElementById(j[Y][_]).querySelector('.tsfem-e-focus-assessment-rating'),Z)}},O=(Y,Z)=>{let _=j;_&&_===Object(_)||(_=[]),_[Z]&&_[Z]===Object(_[Z])||(_[Z]=[]),Y.id&&('undefined'==typeof h[Z]?delete _[Z][Y.id]:0>_[Z].indexOf(Y.id)&&_[Z].push(Y.id)),j=_};var P={},Q={};const R=Y=>{const Z=ca=>{tsfem_inpost.promiseLoop(j[ca],da=>{let ea=k(da),fa=m(ea,'keyword'),ga=fa.value||'';if(ga.length){let ha=document.getElementById(da),ia=ha.querySelector('.tsfem-e-focus-assessment-rating');tsfem_inpost.setIconClass(ia,'loading'),setTimeout(()=>q(ha),150)}})},_=ca=>{'undefined'==typeof j[ca.data.type]||(clearTimeout(P[ca.data.type]),!Q[ca.data.type]&&(setTimeout(()=>tsfem_inpost.setIconClass(document.querySelectorAll('[data-assessment-type="'+ca.data.type+'"] .tsfem-e-focus-assessment-rating'),'unknown'),0),Q[ca.data.type]=!0),P[ca.data.type]=setTimeout(()=>{Z(ca.data.type),Q[ca.data.type]=!1},1500))},aa=ca=>{let da=U(ca).get('names');c(h[ca].join(', ')).off(da).on(da,{type:ca},_)};if(Y)'undefined'==typeof h[Y]?(ca=>{let da=U(ca).get('names');c(h[ca].join(', ')).off(da)})(Y):aa(Y);else{for(var ca in h)aa(ca)}};var S={};const T=Y=>{Y=Y||0,clearTimeout(S[Y]),S[Y]=setTimeout(()=>{if(Y){let Z=m(Y,'scores'),_=Z&&Z.querySelectorAll('.tsfem-e-focus-assessment-wrap[data-assess="1"]');_ instanceof NodeList&&_.length?tsfem_inpost.promiseLoop(_,aa=>{tsfem_inpost.setIconClass(aa.querySelector('.tsfem-e-focus-assessment-rating'),'loading'),q(aa)},100):D(Y).to('error')}else{for(var Z in h)c(h[Z].join(', ')).trigger(U(Z).get('trigger'))}},1e3)},U=Y=>{const Z=['tsfem-e-focus.analysis-'+Y,'input.tsfem-e-focus-'+Y,'change.tsfem-e-focus-'+Y];return{get:_=>{return'names'===_?Z.join(' '):'trigger'===_?Z[0]:Z}}},V=()=>{const Y=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;(()=>{if('undefined'!=typeof d.focusElements.pageUrl){let Z=document.getElementById('edit-slug-box');if(Z&&!(!Z instanceof HTMLElement)){const _=()=>{let aa=document.querySelectorAll('.tsfem-e-focus-assessment-wrap[data-assessment-type="url"][data-assess="0"]');aa instanceof NodeList&&aa.length&&(p('pageUrl'),R('pageUrl'),aa.forEach(ba=>C(ba)))};new Y(()=>{_(),c('#sample-permalink').trigger(U('pageUrl').get('trigger'))}).observe(Z,{childList:!0,subtree:!0})}}})(),(()=>{if('undefined'!=typeof tinyMCE&&'function'==typeof tinyMCE.on){let Z=!1;tinyMCE.on('addEditor',_=>{if(!Z&&'content'===_.editor.id){Z=!0,p('pageContent'),R('pageContent');let aa={},ba=tinyMCE.get('content'),ca=!1,da=!1;ba.on('Dirty',()=>{da||(N('pageContent','unknown'),da=!0)}),ba.on('GetContent',()=>{clearTimeout(aa.GetContent),!ca&&ba.isDirty()&&(N('pageContent','loading'),ca=!0,da=!1),aa.GetContent=setTimeout(()=>{ba.isDirty()||c('#content').trigger(U('pageContent').get('trigger')),ca=!1,da=!1},1e3)})}})}})()},W=()=>{let Y=document.querySelectorAll('.tsfem-e-focus-collapse-wrap');for(let Z=Y.length;Z--;){let _=k(Y[Z].id),aa=m(_,'keyword');if(aa.value.length){if(aa.dataset.prev=aa.value,tsfem_inpost.isPremium){let ba=m(_,'lexical_selector');ba.dataset.prev=ba.value,1<ba.length?A(_).to('enabled'):v(_,'lexical'),+ba.value&&(E(_).to('enabled'),z(_),K(_))}B(_)}}},X=()=>{if(V(),d.hasOwnProperty('focusElements')&&(o(d.focusElements,!0),p(),R()),0===Object.keys(h).length){let Z=document.getElementById('tsfem-e-focus-analysis-wrap').querySelector('.tsf-flex-setting-input');return void(Z instanceof Element&&(Z.innerHTML=wp.template('tsfem-e-focus-nofocus')()))}F(),G(),tsfem_inpost.isPremium&&(H(),J()),W()};return c.extend({load:function(){c('.tsfem-e-focus-enable-if-js').removeProp('disabled'),c('.tsfem-e-focus-disable-if-js').prop('disabled','disabled'),c('.tsfem-e-focus-requires-javascript').removeClass('tsfem-e-focus-requires-javascript'),c(document.body).ready(X)}},{focusRegistry:g,activeFocusAreas:h,activeAssessments:j,updateFocusRegistry:o,updateActiveFocusAreas:p,resetAnalysisChangeListeners:R,triggerAllAnalysis:T,analysisChangeEvents:U,getSubIdPrefix:k,getSubElementById:m})}(jQuery),jQuery(window.tsfem_e_focus_inpost.load);
