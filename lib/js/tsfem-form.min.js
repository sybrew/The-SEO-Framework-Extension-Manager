'use strict';window.tsfemForm={nonce:tsfemFormL10n.nonce,i18n:tsfemFormL10n.i18n,callee:tsfemFormL10n.callee,parseElementData:function(a,b){let c,d=tsfemForm.getElementData(a,b);try{c=d&&JSON.parse(d)}catch(a){c=d}finally{return c}},getElementData:function(a,b){return 0===b.indexOf("data-")&&(b=jQuery.camelCase(b.slice(5))),!!a.dataset.hasOwnProperty(b)&&a.dataset[b]},setupIterations:function(){let a=jQuery(".tsfem-form-iterator-selector-wrap input");if(!a.length)return;tsfemForm.prepareItItems(a);let b,c,d,e,f,g,h,i,j=0,k=1500,l=0,m=0,n=2;const o=()=>{b=document.createElement("span"),b.className="tsfem-form-iterator-timer",c=document.createElement("span"),c.style.width="0%",b.appendChild(c)};o(),d=k/(100*n),d*=.975;const p=()=>{c.style.width=++l/n+"%"},q=()=>{l=0,c.style.width="0%",b.classList.remove("tsfem-form-iterator-timer-invalid")},r=()=>{l=100,c.style.width=l+"%",b.classList.add("tsfem-form-iterator-timer-invalid")},s=()=>{h&&h.remove(),f=g=h=void 0,o(),setTimeout(()=>{a.prop("disabled",!1)},500),a.off("input.fIt").on("input.fIt",e)},t=()=>{a.off("input.fIt"),a=jQuery(".tsfem-form-iterator-selector-wrap input"),tsfemForm.prepareItItems(a),tsfemForm.prepareCollapseItems(),tsfemForm.setupGeo(),"tsfMedia"in window&&tsfMedia.resetImageEditorActions(),a.on("input.fIt",e),tsfTT.triggerReset(),i=void 0},u=()=>{i&&(i.value=i.dataset.tsfemFormPrevValue)};let v=jQuery(window);v.on("tsfemForm.iterationFail",u),v.on("tsfemForm.iterationLoad tsfemForm.deiterationLoad tsfemForm.iterationFail",s),v.on("tsfemForm.iterationComplete tsfemForm.deiterationComplete tsfemForm.iterationFail",t),e=function(l){return clearInterval(m),clearTimeout(j),q(),tsfemForm.disableSubmit(l.target.form),i=l.target,l.target.checkValidity()?void(m=setInterval(p,d),!f&&(f=jQuery(l.target),g=f.closest(".tsfem-form-setting").find(".tsfem-form-setting-label-inner-wrap"),a.not(l.target).prop("disabled",!0),g.append(b),h=g.find("span.tsfem-form-iterator-timer")),j=setTimeout(()=>{if(f.prop("disabled",!0),clearInterval(m),c.style.width="100%",+l.target.value==+l.target.dataset.tsfemFormPrevValue)s(),tsfemForm.enableSubmit(l.target.form);else if(+l.target.value<+l.target.dataset.tsfemFormPrevValue)tsfemForm.unloadIterations(l.target),tsfemForm.enableSubmit(l.target.form);else if(40<+l.target.value){200<+l.target.value?tsfem_ui.dialog({title:tsfemFormL10n.i18n.performanceWarning,text:[tsfemFormL10n.i18n.itHugeConfirm,tsfemFormL10n.i18n.aysProceed],confirm:tsfemFormL10n.i18n.proceed,cancel:tsfemFormL10n.i18n.cancel}):tsfem_ui.dialog({title:tsfemFormL10n.i18n.performanceWarning,text:[tsfemFormL10n.i18n.itLargeConfirm,tsfemFormL10n.i18n.aysProceed],confirm:tsfemFormL10n.i18n.proceed,cancel:tsfemFormL10n.i18n.cancel});let a={};a._cancel=()=>{u(),s(),a._reset(),tsfemForm.enableSubmit(l.target.form)},a._confirm=()=>{tsfemForm.loadIterations(l.target),a._reset()},a._reset=()=>{window.removeEventListener("tsfem_modalCancel",a._cancel),window.removeEventListener("tsfem_modalConfirm",a._confirm)},window.addEventListener("tsfem_modalCancel",a._cancel),window.addEventListener("tsfem_modalConfirm",a._confirm)}else tsfemForm.loadIterations(l.target)},k)):void r()},a.on("input.fIt",e)},unloadIterations:function(a){if(a){let b=a.id.slice(0,a.id.lastIndexOf("[")),c=document.getElementById(b+"-wrapper");c.style.willChange="contents";let d=jQuery(window),e=jQuery(c).children(".tsfem-form-collapse").slice(a.value);d.trigger("tsfemForm.deiterationLoad",[a,e]),e.remove(),d.trigger("tsfemForm.deiterationComplete"),c.style.willChange="auto"}},loadIterations:function(a){if(!a)return;let b=a.id.slice(0,a.id.lastIndexOf("[")),c=jQuery(a).closest(".tsfem-pane-wrap").find(".tsfem-pane-header .tsfem-ajax"),d=0,e="",f=document.getElementById(b+"-wrapper"),g=document.createElement("div");g.className="tsfem-flex-status-loading tsfem-flex tsfem-flex-center",g.appendChild(document.createElement("span")),f.appendChild(g),tsfem.resetAjaxLoader(c),tsfem.setAjaxLoader(c),jQuery.ajax({method:"POST",url:ajaxurl,dataType:"html",data:{action:"tsfemForm_iterate",nonce:tsfemForm.nonce,args:{caller:b,callee:tsfemForm.callee,previousIt:a.dataset.tsfemFormPrevValue,newIt:a.value}},timeout:1e4,async:!0}).done((b,c,g)=>{let h=g.getResponseHeader("content-type"),i=jQuery(window);i.trigger("tsfemForm.iterationLoad"),-1<h.indexOf("json")?(a.value=a.dataset.tsfemFormPrevValue,tsfem_ui.unexpectedAjaxErrorNotice(b),e=tsfem.i18n.InvalidResponse,i.trigger("tsfemForm.iterationFail")):(jQuery(f).append(b),d=1,i.trigger("tsfemForm.iterationComplete"))}).fail((a,b,c)=>{e=tsfem.getAjaxError(a,b,c),c&&tsfem_ui.setTopNotice(-1,"Thrown error: "+c),jQuery(window).trigger("tsfemForm.iterationFail")}).always(()=>{f.removeChild(g),tsfemForm.enableSubmit(a.form),tsfem.updatedResponse(c,d,e)})},prepareItItems:function(a){a.each((a,b)=>{b.dataset.tsfemFormPrevValue=b.value})},setupGeo:function(){if(!jQuery("[data-geo-api-component=\"action\"]").length)return;let a=!1;{var b=document.createElement("div");b.className="tsfem-form-setting-action tsfem-flex",b.dataset.geoApiIsButtonWrap=1,b.style.opacity=0;let a=document.createElement("button");a.className="tsfem-button-primary tsfem-button-primary-bright tsfem-button-cloud",a.innerHTML=tsfemForm.i18n.validate,a.type="button",b.appendChild(a);var c=document.createElement("div");c.className="tsfem-description tsfem-form-option-description",c.dataset.geoApiIsButtonWarning=1,c.style.opacity=0,c.innerHTML=tsfemForm.i18n.reverseGeoWarning}const d=function(b,c){let d=jQuery(b).closest("[data-geo-api-component=\"action\"]"),e=j(d);a=!0,e.each((a,b)=>{let d=tsfemForm.parseElementData(b,"geoApiComponent"),e={};d="object"==typeof d&&d||{0:d};loopComponents:for(let a in d){if(c.hasOwnProperty(d[a]))switchComponents:switch(d[a]){case"route":case"street_number":if(1<d.length){if(e[d[a]]=c[d[a]],1<Object.keys(e).length){b.value=e.route+" "+e.street_number;break loopComponents}break switchComponents}else{b.value=c[d[a]];break loopComponents}break;case"locality":case"country":case"postal_code":case"region":b.value=c[d[a]];break loopComponents;case"lat":case"lng":b.value=parseFloat(parseFloat(c[d[a]]).toFixed(7));break loopComponents;default:break loopComponents;}continue}jQuery(b).trigger("change")}),a=!1},e=function(a,b){let c={},e={};loopData:for(let a in b){let d=b[a].address_components,f=b[a].geometry.location;c[a]={},e[a]=b[a].formatted_address,c[a].lat=f.lat,c[a].lng=f.lng;loopComponents:for(let b in d){let e=d[b].short_name,f=d[b].types;loopTypes:for(let b in f)switchTypes:switch(f[b]){case"route":case"street_number":case"country":case"postal_code":c[a][f[b]]=e;break loopTypes;case"locality":c[a].locality=e;break loopTypes;case"postal_town":f.locality||(c[a].locality=e);break loopTypes;case"administrative_area_level_1":c[a].region=e;break loopTypes;case"administrative_area_level_2":f.administrative_area_level_1||(c[a].region=e);break loopTypes;default:break switchTypes;}}1<b.length&&!c[a].hasOwnProperty("route")&&(delete c[a],delete e[a])}if(!Object.keys(c).length)tsfem_ui.setTopNotice(17004),i(jQuery(a).closest("[data-geo-api-component=\"action\"]"));else{tsfem_ui.dialog({title:tsfemFormL10n.i18n.selectAddressTitle,text:tsfemFormL10n.i18n.selectAddressText,select:e,confirm:tsfemFormL10n.i18n.select,cancel:tsfemFormL10n.i18n.cancel});let b={};b._cancel=()=>{tsfemForm.enableButton(a),b._close()},b._confirm=function(f){if("checked"in f.detail){let b=c[f.detail.checked];void 0!==b&&d(a,b)}i(jQuery(a).closest("[data-geo-api-component=\"action\"]")),b._close()},b._close=()=>{window.removeEventListener("tsfem_modalCancel",b._cancel),window.removeEventListener("tsfem_modalConfirm",b._confirm)},window.addEventListener("tsfem_modalCancel",b._cancel),window.addEventListener("tsfem_modalConfirm",b._confirm)}},f=function(a){let b=jQuery(a.target).closest("[data-geo-api-component=\"action\"]"),c=j(b),d={};tsfemForm.disableButton(a.target),c.each((a,b)=>{b.value&&(d[b.dataset.geoApiComponent]=b.value)});let f={target:a.target,callbacks:{success:e,failure:()=>{tsfemForm.enableButton(a.target)},always:()=>{}}};tsfemForm.getGeoData(d,a.target.dataset.formId,f)},g=function(a,d,e){if(e=void 0===e?1:e,!e)return i(a);let g=a&&a.find(".tsfem-form-multi-setting-label-inner-wrap");if(!g.length)return;if(!a.data("geo-api-has-button")){let c=b.cloneNode(!0);g.append(c),a.data("geo-api-has-button",1),c.getElementsByTagName("button")[0].dataset.formId=d,c.getElementsByTagName("button")[0].addEventListener("click",f),tsfem_ui.fadeIn(c,300)}let h=g.find("[data-geo-api-is-button-warning]").first();if(2===e){if(h.length)return;let a=c.cloneNode(!0);g.append(a),tsfem_ui.fadeIn(a,300)}else{if(!h.length)return;tsfem_ui.fadeOut(h[0],300,()=>h[0].remove())}},h=function(a,b,c){g(a,b,c)},i=function(a){let b=a&&a.find(".tsfem-form-multi-setting-label-inner-wrap")||void 0;b&&b.find(b.children("[data-geo-api-is-button-wrap], [data-geo-api-is-button-warning]")).fadeOut(300,function(){this.remove(),a.removeData("geo-api-has-button")})},j=function(a){return a.find("[data-geo-api=\"1\"]")},k=function(a){let b=j(a);if(!b.length)return 0;let c,d=0,e=b.filter("[data-geo-api-component=\"lat\"]").first().val(),f=b.filter("[data-geo-api-component=\"lng\"]").first().val();if(b.each((a,b)=>{if(-1<jQuery(b).data("geo-api-component").indexOf("route"))return c=b.value,!1}),e&&f)d=/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(e)&&-90<=e&&90>=e?2:0,d=d&&/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(f)&&-180<=f&&180>=f?2:0;else if(c&&(d=/^((([0-9\/-]+([\/-0-9A-Z]+)?(\s|(,\s)))([\u00a1-\uffffa-zA-Z\.\s]|[0-9_/-])+))|(([\u00a1-\uffffa-zA-Z\.\s]|[0-9_/-])+)((\s|(,\s))([0-9\/-]+([\/-0-9A-Z]+)?))$/.test(c)?1:0,!d)){let a=0;b.not("[data-geo-api-component=\"lat\"], [data-geo-api-component=\"lng\"]").each((b,c)=>{if(c.value.length&&1<++a)return!1}),d=1<a}return d};let l=0;const m=b=>{a||(clearTimeout(l),l=setTimeout(()=>{if(tsfemForm.getElementData(b.target,"geoApiComponent")){let a=jQuery(b.target).closest("[data-geo-api-component=\"action\"]"),c=k(a);a.data("geo-api-has-button")?c?h(a,b.target.form.id,c):i(a):g(a,b.target.form.id,c)}},500))};let n=jQuery("input[data-geo-api=\"1\"]"),o=jQuery("select[data-geo-api=\"1\"]");n&&n.off("input.tsfemForm.addButtonIfValid").on("input.tsfemForm.addButtonIfValid",m),o&&o.off("change.tsfemForm.addButtonIfValid").on("change.tsfemForm.addButtonIfValid",m)},getGeoData:function(a,b,c){let d=document.getElementById(b),e=jQuery(d).closest(".tsfem-pane-wrap").find(".tsfem-pane-header .tsfem-ajax"),f=0,g="";return tsfemForm.disableSubmit(d),tsfem.resetAjaxLoader(e),tsfem.setAjaxLoader(e),jQuery.ajax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfemForm_get_geocode",nonce:tsfemForm.nonce,input:JSON.stringify(a)},processData:!0,timeout:14e3,async:!0}).done(a=>{a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&void 0;let b=a&&a.data||void 0,d=a&&a.type||void 0;b&&d?"failure"===d?(tsfem_ui.unexpectedAjaxErrorNotice(a),c.callbacks.failure(c.target)):"geodata"in b&&(f=1,c.callbacks.success(c.target,b.geodata.results)):g=tsfem.i18n.InvalidResponse}).fail((a,b,d)=>{g=tsfem.getAjaxError(a,b,d),tsfem_ui.setTopNotice(17200),d&&tsfem_ui.setTopNotice(-1,"Thrown error: "+d),c.callbacks.failure(c.target)}).always(()=>{tsfem.updatedResponse(e,f,g),tsfemForm.enableSubmit(d),c.callbacks.always(c.target)})},prepareCollapseItems:function(){jQuery(".tsfem-form-collapse > input").off("change.tsfemForm.prepareItems").on("change.tsfemForm.prepareItems",function(a){tsfemForm.prepareCollapseTitles(a),tsfemForm.prepareCollapseValidity(a)}).trigger("change.tsfemForm.prepareItems")},prepareCollapseTitles:function(a){const b=function(a){let b=jQuery(a.data._tsfemFormLabel),c=b.find(".tsfem-form-collapse-title"),d=b.data("dyntitleprep"),e=jQuery(a.target).val();e?c.text(d+" - "+e):c.text(d)},c=function(a){let b=a.target.checked||!1,c=jQuery(a.data._tsfemFormLabel),d=c.find(".tsfem-form-collapse-title"),e=c.data("dyntitleprep");b?d.text(e+" - "+c.data("dyntitlechecked")):d.text(e)},d=function(a){let b=jQuery(a.data._tsfemFormLabel),c=b.find(".tsfem-form-collapse-title"),d=b.data("dyntitleprep"),e=[];jQuery(a.data._tsfemFormThings).map((a,b)=>{b.checked&&e.push(b.value)});let f=e.join(", ");f?c.text(d+" - "+f):c.text(d)};(function(a){let e,f=jQuery(a.target).siblings("label"),g=f.data("dyntitletype"),h=f.data("dyntitleid")+"["+f.data("dyntitlekey")+"]";switch(g){case"single":case"checkbox":let a=document.getElementById(h);e="input.tsfemForm.doTitleChangeSingle",jQuery(a).off(e).on(e,{_tsfemFormLabel:f},"checkbox"===g?c:b).trigger(e);break;case"plural":let i=jQuery(document.getElementById(h)).find("input[type=checkbox]");e="input.tsfemForm.doTitleChangeSingle";;i.off(e).on(e,{_tsfemFormLabel:f,_tsfemFormThings:i},d).trigger(e);}})(a)},prepareCollapseValidity:function(a){const b=function(a,b){let c="tsfem-form-collapse-header-error",d="tsfem-form-collapse-header-good",e=".tsfem-form-title-icon",f="tsfem-form-title-icon-unknown",g="tsfem-form-title-icon-error",h="tsfem-form-title-icon-good";0<b?(a.removeClass(d).addClass(c),a.find(e).removeClass(f+" "+h).addClass(g)):0>b?(a.removeClass(c+" "+d).addClass(d),a.find(e).removeClass(h+" "+g).addClass(f)):(a.removeClass(c).addClass(d),a.find(e).removeClass(f+" "+g).addClass(h))},c=function(a,c){let d,e;a.each((a,f)=>{d=jQuery(f),e=(+d.data("tsfemErrorCount")||0)+c,d.data("tsfemErrorCount",e),b(d,e)})},d=function(a){let b=0;b="tsfemWasValid"in a.target.dataset?+a.target.dataset.tsfemWasValid:a.target.dataset.tsfemWasValid=1;let d=a.target.disabled||a.target.checkValidity(),e=jQuery(a.target).parents(".tsfem-form-collapse").children(".tsfem-form-collapse-header"),f=+e.data("tsfemErrorCount");f?b&&!d?(a.target.dataset.tsfemWasValid=+d,c(e,+1)):!b&&d&&(a.target.dataset.tsfemWasValid=+d,c(e,-1)):d?c(e,0):(a.target.dataset.tsfemWasValid=+d,c(e,+1))},e=function(a,b){let c=a.dataset.tsfemDidInitialValidation||0;c||(b.on("tsfemForm.first.checkValidity",d),b.each((a,b)=>{jQuery(b).trigger("tsfemForm.first.checkValidity")}),b.off("tsfemForm.first.checkValidity"),a.dataset.tsfemDidInitialValidation=1)};(function(a){let b=jQuery(a.target).siblings(".tsfem-form-collapse-content").find("input, select, textarea").not(".tsfem-form-collapse-checkbox");b.off("change.tsfemForm.checkValidity"),a.target.checked||b.on("change.tsfemForm.checkValidity",d),e(a.target,b)})(a),tsfemForm.prepareCustomChecks(d),tsfemForm.prepareDeiterationValidityChecks(d)},prepareCustomChecks:function(a){const b=function(b,c){if(c){let b=jQuery(c);b.length&&(b.one("tsfemForm.temp.customChecks.checkValidityCb",a),b.trigger("tsfemForm.temp.customChecks.checkValidityCb"))}},c=()=>{jQuery(window).on("tsfemForm.customValidationChecks",b)},d=()=>{jQuery(window).off("tsfemForm.customValidationChecks")};(()=>{d(),c(),jQuery(window).off("tsfemForm.iterationLoad.customValidation").off("tsfemForm.iterationFail.customValidation").off("tsfemForm.iterationComplete.customValidation").on("tsfemForm.iterationLoad.customValidation",d).on("tsfemForm.iterationFail.customValidation",c).on("tsfemForm.iterationComplete.customValidation",c)})()},triggerCustomValidation:function(a){a instanceof HTMLElement&&jQuery(window).trigger("tsfemForm.customValidationChecks",[a])},prepareDeiterationValidityChecks:function(a){const b=function(b,c,d){if(d){let b=d.children(".tsfem-form-collapse-content").find("input:invalid, select:invalid, textarea:invalid");b&&(b.prop("disabled",!0),b.on("tsfemForm.temp.disableAndValidate.checkValidityCb",a),b.each((a,b)=>{jQuery(b).trigger("tsfemForm.temp.disableAndValidate.checkValidityCb")}),b.off("tsfemForm.temp.disableAndValidate.checkValidityCb"))}};(()=>{jQuery(window).off("tsfemForm.deiterationLoad.disableAndValidate").on("tsfemForm.deiterationLoad.disableAndValidate",b)})()},setupSpecialRequired:function(){let a="tsfem-form-checkbox-required";{var b=document.createElement("input");b.className=a,b.setAttribute("type","checkbox"),b.setAttribute("required","required"),b.setAttribute("value","1"),b.setAttribute("tabIndex","-1")}const c=function(a,b){let c=(+a.data("required-check-count")||0)+b;return a.data("required-check-count",c),c},d=function(c){if(!c.children("."+a).length){let a=b.cloneNode(!1);a.setCustomValidity(tsfemForm.i18n.requiredSelectAny),jQuery(a).prependTo(c),tsfemForm.triggerCustomValidation(a)}c.removeClass("tsfem-form-multi-valid").addClass("tsfem-form-multi-invalid")},e=function(b){let c=b.children("."+a);if(c.length){let a=c[0].cloneNode(!1);c.remove(),a.checked=!0,a.required=!1,jQuery(a).prependTo(b),tsfemForm.triggerCustomValidation(a),a.remove()}b.removeClass("tsfem-form-multi-invalid").addClass("tsfem-form-multi-valid")},f=function(a){if(a.target.disabled)return;let b,f=jQuery(a.target).closest(".tsfem-form-multi-select-wrap[data-required=\"1\"]"),g=f.data("required-check-count");b=a.target.checked?c(f,+1):c(f,-1),1>g?b>g&&e(f):1>b&&d(f)},g=()=>{let a,b,e,g=jQuery(".tsfem-form-multi-select-wrap[data-required=\"1\"]");g.each((g,h)=>{b=h.dataset.requiredCheckCount,void 0===b&&(a=jQuery(h),a.find("input").on("change.tsfemForm.testChecked",f),e=a.find("input:checked").length,e?a.addClass("tsfem-form-multi-valid"):d(a),c(a,+e))})};g(),jQuery(window).on("tsfemForm.iterationComplete",g)},setupTypeListener:function(){const a=function(b,c){let d;if("object"==typeof b)for(let e in b)if(d=a(b[e],c),!1!==d)return e;return c===b&&c},b=function(b){let c,d;const e=b.target;return(e.dataset.typeInitTested=1,c="checkbox"===e.type.toLowerCase()?e.checked?e.value:"0":e.value,!c)?(e.dataset.type="",void jQuery(e).trigger("tsfemForm.typeIsSet")):void(d=tsfemForm.parseElementData(e,"setTypeToIfValue"),d&&(e.dataset.type=a(d,c)||"",jQuery(e).trigger("tsfemForm.typeIsSet")))},c=()=>{let a=jQuery("[data-is-type-listener=\"1\"]");a.each((a,c)=>{c.dataset.typeInitTested||jQuery(c).off("change.tsfemForm.typeListener").on("change.tsfemForm.typeListener",b).trigger("change.tsfemForm.typeListener")})};c(),jQuery(window).on("tsfemForm.iterationComplete",c)},setupShowIfListener:function(){let a="input, select, textarea",b={duration:150,easing:"linear",queue:!1,start:function(){this.style.willChange="opacity"},done:function(){let a=this.style.display;this.removeAttribute("style"),this.style.display=a}};const c=a=>{let b,c=a.dataset.isShown||void 0;try{b=JSON.parse(c)}catch(a){}if(b)for(let a in b)if(-1==+b[a])return!1;return!0},d=(a,b,c)=>{let d,e=a.dataset.isShown||void 0;try{d=JSON.parse(e)}catch(a){}return(d||={},!(d.hasOwnProperty(b)&&+c==+d[b]))&&(d[b]=+c,a.dataset.isShown=JSON.stringify(d),!0)},e=(a,b)=>{let c=a.dataset.disabledShowif;return a.dataset.disabledShowif=c?+c+b:+b},f=(c,f)=>{if(d(c,f,-1)){let d=jQuery(c);d.is(a)?(d.closest(".tsfem-form-setting").fadeOut(b),c.disabled=!0,e(c,1),tsfemForm.triggerCustomValidation(c)):(d.fadeOut(b),d.find(a).each((a,b)=>{b.disabled=!0,e(b,1),tsfemForm.triggerCustomValidation(b)}))}},g=(f,g)=>{if(d(f,g,1)){let d=jQuery(f);if(d.is(a))1>e(f,-1)&&(f.disabled=!1,tsfemForm.triggerCustomValidation(f),d.closest(".tsfem-form-setting").fadeIn(b));else{let f,g=d.hasClass("tsfem-form-multi-setting");d.find(a).each((a,b)=>(f=e(b,-1),g&&!c(b)||void(1>f&&(b.disabled=!1,tsfemForm.triggerCustomValidation(b),jQuery(b).show())))),d.fadeIn(b)}}},h=(a,c,d)=>{let e={};jQuery(c).off("tsfemForm.typeIsSet",a).on("tsfemForm.typeIsSet",a,()=>{clearTimeout(e[c.id]),e[c.id]=setTimeout(()=>{c.dataset.type===d?g(a,c.id):f(a,c.id),delete e[c.id]},b.duration+25)}),c.dataset.type===d?g(a,c.id):f(a,c.id)},i=a=>{let b=tsfemForm.parseElementData(a,"showif");if(!b)return;let c,d,e=jQuery(a).closest(".tsfem-form-collapse-content");for(d in e.length||(e=jQuery(a).closest(".tsfem-form-multi-setting")),b)break;if(d)return c=e?e.find("[data-showif-catcher=\""+d+"\"]"):jQuery(a.form).find("[data-showif-catcher=\""+d+"\"]"),c.length?{target:c[0],value:b[d]}:void 0},j=a=>{a.dataset.showIfIsInit="1";let b=i(a);b&&h(a,b.target,b.value)},k=()=>{let a=jQuery("[data-is-showif-listener=\"1\"]"),c=b.duration;b.duration=0,a.each((a,b)=>{b.dataset.showIfIsInit||j(b)}),b.duration=c};k(),jQuery(window).on("tsfemForm.iterationComplete",k)},adjustSubmit:function(){let a=jQuery("form.tsfem-form");a.each((a,b)=>{jQuery(document.querySelectorAll("[type=submit][form=\""+b.id+"\"]")).attr("onclick","tsfemForm.saveInput( event )")})},doValidityRoutine:function(a,b){if(b||=tsfemFormL10n.i18n.collapseValidate,!a.checkValidity()){let c=a.querySelector("input:invalid, select:invalid, textarea:invalid"),d=!1;const e=()=>{if(d)return void f();try{return void c.reportValidity()}catch(a){tsf.l10n.states.debug}},f=()=>{let a=jQuery(c).parents(".tsfem-form-collapse"),g=-1;if(a=jQuery(a.get().reverse()),jQuery(a).each((a,b)=>{let c=jQuery(b).children(".tsfem-form-collapse-checkbox").is(":checked");if(c)return g=a,!1}),-1===g)return d=!1,e();d=!0;let h,i,j;h=a.slice(g).first(),i=h.find(".tsfem-form-collapse-header").first(),j=h.find(".tsfem-form-collapse-checkbox").first();let k;const l=function(a){clearTimeout(k),k=setTimeout(()=>{let b=document.documentElement.scrollTop,c=document.documentElement.clientHeight,d=a.offset().top,e=jQuery("#tsfem-sticky-top").height()+1*c/3,f=!1;d-e<b?f=!0:d+e>c+b&&(f=!0),f&&jQuery(document.documentElement).animate({scrollTop:d-e},500)},50)};tsfTT.doTooltip(void 0,i,b),l(i),j.off("change.tsfemForm.removeToolTip").on("change.tsfemForm.removeToolTip",function(a){let b=jQuery(a.target);tsfTT.removeTooltip(b.siblings(".tsfem-form-collapse-header")),b.off("change.tsfemForm.removeToolTip"),f()})};return c?f():e(),!1}return!0},saveInput:function(a){tsfemForm.preventSubmit(a);const b=a.target;let c,d,e=b.getAttribute("form");if(e){if(c=document.getElementById(e),!c)return tsfemForm.preventSubmit(a);if(!tsfemForm.doValidityRoutine(c,tsfemFormL10n.i18n.collapseValidate))return;d=b}else c=b,d=document.querySelector(`[type=submit][form="${c.id}"]`);let f=jQuery(c).closest(".tsfem-pane-wrap").find(".tsfem-pane-header .tsfem-ajax"),g=0,h="";return tsfemForm.disableButton(d),tsfem.resetAjaxLoader(f),tsfem.setAjaxLoader(f),jQuery.ajax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfemForm_save",nonce:tsfemForm.nonce,data:jQuery(c).serialize()},processData:!0,timeout:14e3,async:!0}).done(a=>{a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&void 0;let b=a?.data||void 0,c=a?.type||void 0;if(!b||!c)h=tsfem.i18n.InvalidResponse;else{let a=b?.results.code||void 0;a?(b?.data?.failed.length?(g=0,h=tsfem.i18n.UnknownError):g=1,tsfem_ui.setTopNotice(a)):h=tsfem.i18n.UnknownError}}).fail((a,b,c)=>{h=tsfem.getAjaxError(a,b,c),tsfem_ui.setTopNotice(1071101),c&&tsfem_ui.setTopNotice(-1,"Thrown error: "+c)}).always(()=>{tsfem.updatedResponse(f,g,h),tsfemForm.enableButton(d)}),!0},preventSubmit:function(a){return a.preventDefault(),a.stopPropagation(),!1},enableButton:function(a){setTimeout(()=>{let b=jQuery(a);b.removeClass("tsfem-button-disabled tsfem-button-loading"),b.prop("disabled",!1)},1)},disableButton:function(a,b){b=!(void 0!==b)||b;let c=jQuery(a);b?c.addClass("tsfem-button-disabled tsfem-button-loading"):c.addClass("tsfem-button-disabled"),c.prop("disabled",!0)},enableSubmit:function(a){a?.id&&tsfemForm.enableButton(`[form="${a.id}"]`)},disableSubmit:function(a,b){a?.id&&tsfemForm.enableButton(`[form="${a.id}"]`,b)},doReady:function(){tsfemForm.setupIterations(),tsfemForm.setupGeo(),"tsfMedia"in window&&tsfMedia.resetImageEditorActions(),tsfemForm.setupSpecialRequired(),tsfemForm.setupTypeListener(),tsfemForm.setupShowIfListener(),tsfemForm.prepareCollapseItems(),tsfemForm.adjustSubmit()}},jQuery(tsfemForm.doReady);
