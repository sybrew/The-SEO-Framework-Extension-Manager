'use strict';window.tsfem={nonce:tsfemL10n.nonce,i18n:tsfemL10n.i18n,rtl:tsfemL10n.rtl,debug:tsfemL10n.debug,touchBuffer:!1,noticeBuffer:!1,navWarn:!1,setTouchBuffer:function(a){tsfem.touchBuffer=!0,setTimeout(function(){tsfem.touchBuffer=!1},a)},initDescHover:function(){let a='.tsfem-has-hover-balloon',b=jQuery(a);b.off('mouseenter mousemove mouseleave mouseout'),b.children('*').off('mouseenter mousemove mouseleave'),jQuery(document.body).off('click touchstart MSPointerDown',tsfem.touchLeaveDescHover),b.children('*').on({mouseenter:function(c){jQuery(c.target).parents(a).trigger('mouseenter')},mousemove:function(c){jQuery(c.target).parents(a).trigger('mousemove',c.pageX)},mouseleave:function(c){jQuery(c.target).parents(a).trigger('mouseleave')}}),b.on({mouseenter:tsfem.enterDescHover,mousemove:tsfem.moveDescHover,mouseleave:tsfem.leaveDescHover,mouseout:tsfem.leaveDescHover}),jQuery(document.body).on('click touchstart MSPointerDown',tsfem.touchLeaveDescHover)},enterDescHover:function(a){let b=jQuery(a.target);if(!b.hasClass('tsfem-has-hover-balloon'))return!1;let c=b.data('desc');return c&&b.removeAttr('title'),tsfem.doTooltip(b,c)},doTooltip:function(a,b){let c=jQuery(a),d=c.next('.tsfem-desc-balloon').length||c.children('.tsfem-desc-balloon').length;if(d&&tsfem.removeTooltip(a),b){c.append('<div class="tsfem-desc-balloon"><span>'+b+'</span><div></div></div>');let f=c.children('.tsfem-desc-balloon'),g=c.outerHeight()+8,h=f.closest('.tsfem-pane-content'),j=h.children('.tsfem-pane-inner-wrap');h.length&&h.offset().top-(j.prop('scrollTop')||0)>f.offset().top?(f.addClass('tsfem-desc-balloon-down'),f.css('top',g+'px')):f.css('bottom',g+'px');let k=f.children('span');if(h.length){let l=h.offset().left+h.outerWidth(),m=k.offset().left+k.outerWidth(),n=tsfem.rtl?m<k.width():m>l-20;if(n){let o=tsfem.rtl?'right':'left',p=tsfem.rtl?-(m+20):l-m-20;f.css(o,p+'px')}else{let o=42>c.width();if(o){let p=15,q=tsfem.rtl?l<m+p:h.offset().left>k.offset().left-p;q||f.css(tsfem.rtl?'right':'left',-p+'px')}}}}},removeTooltip:function(a){tsfem.getTooltip(a).remove()},getTooltip:function(a){return jQuery(a).find('.tsfem-desc-balloon').first()},moveDescHover:function(a,b){let c=jQuery(a.target);if(!c.hasClass('tsfem-has-hover-balloon'))return!1;let d=c.data('desc');if(d){let f=c.children('.tsfem-desc-balloon'),g=f.children('span');if(0===g.length)return;let h=f.children('div'),j=h.outerWidth()/2,k=b?b:a.pageX,l=g.offset().left,m=k-l-j,n=tsfem.rtl?'right':'left';if(1>m){let o=tsfem.rtl?g.width():0;h.css(n,o+'px')}else{let o=g.outerWidth();if(k>l+o-j){let r=tsfem.rtl?0:g.width();h.css(n,r+'px')}else{let r=tsfem.rtl?-g.width():(o-g.width())/2-j,s=tsfem.rtl?-(m+r):m+r;h.css(n,s+'px')}}}},leaveDescHover:function(a){jQuery(a.target).find('.tsfem-desc-balloon').remove()},touchLeaveDescHover:function(a){tsfem.touchBuffer||(tsfem.setTouchBuffer(200),jQuery('.tsfem-desc-balloon').length&&!jQuery(a.target).closest('.tsfem-has-hover-balloon').length&&jQuery('.tsfem-has-hover-balloon').find('.tsfem-desc-balloon').remove())},setAjaxLoader:function(a){jQuery(a).toggleClass('tsfem-loading')},unsetAjaxLoader:function(a,b,c,d){let f='tsfem-success',g=2500;b?2===b&&(f='tsfem-unknown',g=7500):(f='tsfem-error',g=d?2e4:1e4),g=c?2*g:g,d?jQuery(a).removeClass('tsfem-loading').addClass(f).html(c).fadeOut(g):(c=jQuery('<span/>').html(c).text(),jQuery(a).removeClass('tsfem-loading').addClass(f).text(c).fadeOut(g))},resetAjaxLoader:function(a){jQuery(a).stop().empty().prop('class','tsfem-ajax').css({opacity:'1',display:'initial'}).prop('style','')},updateFeed:function(a){let b='tsfem-button-disabled',c=jQuery(a.target),d='#tsfem-feed-ajax',f=0;if(!c.prop('disabled')){c.addClass(b),c.prop('disabled',!0),tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d);let g=function(){c.removeClass(b),c.prop('disabled',!1),tsfem.updatedResponse(d,f,tsfem.i18n.UnknownError,0)};jQuery.ajax({method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_enable_feeds',nonce:tsfem.nonce},timeout:12000,async:!0,success:function(h){h=tsfem.convertJSONResponse(h),tsfem.debug&&console.log(h);let j=h&&h.data||void 0,k=h&&h.type||void 0;if('success'===k&&j){let o=j.content;switch(o.status){case'success':f=1,jQuery('.tsfem-trends-wrap').empty().css('opacity',0).append(o.wrap).animate({opacity:1},{queue:!0,duration:250},'swing');var l=400,m=o.data.length,n=0;for(let p=1;p<m-1;p++)n+=Math.round(l/Math.pow(1+p/2/100,2));n-=2*l+l/2,jQuery.each(o.data,function(p,q){l=Math.round(l/Math.pow(1+p/2/100,2)),setTimeout(function(){jQuery(q).hide().appendTo('.tsfem-feed-wrap').slideDown(l)},l/2*p)}),setTimeout(function(){tsfem.updatedResponse(d,f,'',0)},n);break;case'parse_error':case'unknown_error':default:jQuery('.tsfem-trends-wrap').empty().css('opacity',0).append(o.error_output).css('opacity',1).find('.tsfem-feed-wrap').css({opacity:0}).animate({opacity:1},{queue:!0,duration:2e3},'swing'),f='unknown_error'===o.status?2:0,setTimeout(function(){tsfem.updatedResponse(d,f,tsfem.i18n.UnknownError,0)},1e3);}}else'unknown'===h.type?(f=2,g()):g()},error:function(h,j,k){let l=tsfem.getAjaxError(h,j,k);c.removeClass(b),c.prop('disabled',!1),tsfem.updatedResponse(d,0,l,0)},complete:function(){}})}},updateExtension:function(a){let b='tsfem-button-disabled',c=jQuery(a.target),d=jQuery('.tsfem-button-extension-activate, .tsfem-button-extension-deactivate').not(jQuery('.'+b)),f='#tsfem-extensions-ajax',g=c.data('slug'),h=c.data('case');c.prop('disabled')||(d.map(function(){jQuery(this).addClass(b),jQuery(this).prop('disabled',!0)}),tsfem.resetAjaxLoader(f),tsfem.setAjaxLoader(f),jQuery.ajax({method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_update_extension',nonce:tsfem.nonce,slug:g,'case':h},timeout:1e4,async:!0,success:function(j){j=tsfem.convertJSONResponse(j),tsfem.debug&&console.log(j);let k=j&&j.data||void 0,l=j&&j.type||void 0;if(!k||!l)tsfem.updatedResponse(f,0,tsfem.i18n.InvalidResponse,0);else{var m=k.status.success,n=k.status.notice,o='topNotice'in k.status&&k.status.topNotice||!1;-1===m?tsfem.updatedResponse(f,0,n,0):(o&&tsfem.setTopNotice(m,o),'activate'===h?!1===m?tsfem.updatedResponse(f,0,n,0):10001===m?tsfem.updatedResponse(f,0,n,0):10002===m?tsfem.updatedResponse(f,0,n,0):10003===m?tsfem.updatedResponse(f,0,n,0):10004===m?tsfem.updatedResponse(f,0,n,0):10005===m?(tsfem.updatedResponse(f,0,n,0),tsfem.initDescHover()):10006===m?tsfem.updatedResponse(f,2,n,0):(c.removeClass('tsfem-button-extension-activate').addClass('tsfem-button-extension-deactivate'),c.data('case','deactivate'),c.text(tsfem.i18n.Deactivate),tsfem.updatedResponse(f,1,n,0),jQuery('#'+g+'-extension-entry').removeClass('tsfem-extension-deactivated').addClass('tsfem-extension-activated'),tsfem.updateExtensionDescFooter(g,h)):'deactivate'===h?!1===m?tsfem.updatedResponse(f,0,n,0):(c.removeClass('tsfem-button-extension-deactivate').addClass('tsfem-button-extension-activate'),c.data('case','activate'),c.text(tsfem.i18n.Activate),tsfem.updatedResponse(f,1,n,0),jQuery('#'+g+'-extension-entry').removeClass('tsfem-extension-activated').addClass('tsfem-extension-deactivated'),tsfem.updateExtensionDescFooter(g,h)):tsfem.updatedResponse(f,0,tsfem.i18n.UnknownError,0))}},error:function(j,k,l){let m=tsfem.getAjaxError(j,k,l);tsfem.updatedResponse(f,0,m,0)},complete:function(){d.removeClass(b),d.prop('disabled',!1)}}))},convertJSONResponse:function(a){let b=a&&a.json||void 0,c=1===b;if(!c){let d=a;try{a=JSON.parse(a),c=!0}catch(f){c=!1}c||(a=d)}return a},updatedResponse:function(a,b,c,d){switch(b){case 0:case 1:case 2:tsfem.unsetAjaxLoader(a,b,c,d);break;default:tsfem.resetAjaxLoader(a);}},getAjaxError:function(a,b,c){tsfem.debug&&(console.log(a.responseText),console.log(c));let d='';switch(c){case'abort':case'timeout':d=tsfem.i18n.TimeoutError;break;case'Internal Server Error':d=tsfem.i18n.FatalError;break;case'parsererror':d=tsfem.i18n.ParseError;break;default:d=tsfem.i18n.UnknownError;}return d},unexpectedAjaxErrorNotice:function(a){a=tsfem.convertJSONResponse(a)||void 0;let b=a&&a.data||void 0;tsfem.debug&&console.log(a),b&&'results'in b&&'code'in b.results&&tsfem.setTopNotice(b.results.code,b.results.notice)},matosa:function(a){var b=null,c='';if(function f(g,h){if(h++,'object'==typeof g){let j,k;for(j in g)k=g[j];b=k,c+=1===h?j+f(k,h):'['+j+']'+f(k,h)}else if(1===h)return b=null,c=!1;return c}(a,0),!1===c)return!1;let d={};return d[c]=b,d},updateExtensionDescFooter:function(a,b){jQuery.ajax({method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_update_extension_desc_footer',nonce:tsfem.nonce,slug:a,'case':b},timeout:3e3,async:!0,success:function(c){c=tsfem.convertJSONResponse(c),tsfem.debug&&console.log(c);let d=c&&c.data||void 0,f=c&&c.type||void 0;if(d){var g=jQuery('#'+a+'-extension-entry .tsfem-extension-description-footer'),h='activate'===b?'up':'down';g.addClass('tsfem-flip-hide-'+h),setTimeout(function(){g.empty().append(d),tsfem.initDescHover()},250),setTimeout(function(){g.addClass('tsfem-flip-show-'+h)},500),setTimeout(function(){g.removeClass('tsfem-flip-hide-'+h+' tsfem-flip-show-'+h)},750)}},error:function(c,d,f){tsfem.debug&&(console.log(c.responseText),console.log(f))},complete:function(){}})},preventDefault:function(a){a.preventDefault(),a.stopPropagation()},resetSwitcher:function(a){let b=jQuery('.tsfem-switch-button-container > input[type="checkbox"]:checked');if('undefined'!=typeof b&&0<b.length){let c=b.parents('.tsfem-switch-button-container-wrap');1>jQuery(a.target).closest(c).length&&b.prop('checked',!1)}},setLastExtensionEntry:function(){let a=jQuery('.tsfem-extensions-overview-content').children('.tsfem-extension-entry-wrap'),b=a.length;if(1&b&&2<b){let c=a.first(),d=a.last();782>window.innerWidth?d.delay(10).css({'max-width':''}):d.delay(10).css({'max-width':c.width()})}},registerNavWarn:function(){tsfem.navWarn=!0},mustNavWarn:function(){return!!tsfem.navWarn},setDismissNoticeListener:function(){let a=jQuery('.tsfem-dismiss');a.off('click',tsfem.dismissNotice),a.on('click',tsfem.dismissNotice)},dismissNotice:function(a){jQuery(a.target).parents('.tsfem-notice').slideUp(200,function(){this.remove()})},setTopNotice:function(a,b){if(tsfem.noticeBuffer)return void window.setTimeout(function(){tsfem.setTopNotice(a,b)},500);tsfem.noticeBuffer=!0;let c=jQuery('.tsfem-notice-wrap'),d=b?1:0;jQuery.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_get_dismissible_notice',nonce:tsfem.nonce,'tsfem-notice-key':a,'tsfem-notice-has-msg':d},timeout:7e3,async:!0,success:function(f){f=tsfem.convertJSONResponse(f),tsfem.debug&&console.log(f);let g=f&&f.data||void 0,h=f&&f.type||void 0;if(!g||!h||'undefined'==typeof g.notice);else{let j=c.children('.tsfem-notice, .tsfem-notice-wrap .notice');if(1<j.length&&j.slice(0,j.length-1).each(function(){jQuery(this).slideUp(200,function(){this.remove()})}),d){let k=jQuery(g.notice).hide().appendTo(c),l=k.find('p').first();tsfem.rtl?l.prepend(b+' '):l.append(' '+b),k.slideDown(200)}else jQuery(g.notice).hide().appendTo(c).slideDown(200);tsfem.setDismissNoticeListener()}},error:function(f,g,h){tsfem.debug&&(console.log(f.responseText),console.log(h))},complete:function(){tsfem.noticeBuffer=!1}})},dialog:function(a){let b=a.title||'',c=a.text||'',d=a.select||'',f=a.confirm||'',g=a.cancel||'',h={};if(h.mask=document.createElement('div'),h.mask.className='tsfem-modal-mask',h.maskNoScroll=document.createElement('div'),h.maskNoScroll.className='tsfem-modal-mask-noscroll',h.mask.appendChild(h.maskNoScroll),h.container=document.createElement('div'),h.container.className='tsfem-modal-container',h.dialogWrap=document.createElement('div'),h.dialogWrap.className='tsfem-modal-dialog-wrap',h.dialogWrap.style.marginLeft=document.getElementById('adminmenuwrap').offsetWidth+'px',h.dialogWrap.style.marginTop=document.getElementById('wpadminbar').offsetHeight+'px',h.dialog=document.createElement('div'),h.dialog.className='tsfem-modal-dialog',h.trap=document.createElement('div'),h.trap.className='tsfem-modal-trap',h.trap.tabIndex=0,h.bottomTrap=h.trap.cloneNode(!1),h.dialog.appendChild(h.trap),h.x=document.createElement('div'),h.x.className='tsfem-modal-dismiss',h.x.addEventListener('click',function(){window.dispatchEvent(new Event('tsfem_modalCancel'))}),h.dialog.appendChild(h.x),b&&(h.titleWrap=document.createElement('div'),h.titleWrap.className='tsfem-modal-title',h.titleWrapTitle=document.createElement('h4'),h.titleWrapTitle.innerHTML=b,h.titleWrap.appendChild(h.titleWrapTitle),h.dialog.appendChild(h.titleWrap)),h.inner=document.createElement('div'),h.inner.className='tsfem-modal-inner',c){if(h.textWrap=document.createElement('div'),h.textWrap.className='tsfem-modal-text',Array.isArray(c))for(let o in c)h.textWrapContent=document.createElement('p'),h.textWrapContent.innerHTML=c[o],h.textWrap.appendChild(h.textWrapContent);else h.textWrapContent=document.createElement('p'),h.textWrapContent.innerHTML=c,h.textWrap.appendChild(h.textWrapContent);h.inner.appendChild(h.textWrap)}let j=!1;if(d){j=!0,h.selectWrap=document.createElement('div'),h.selectWrap.className='tsfem-modal-select';let o={};o.wrap=document.createElement('div'),o.wrap.className='tsfem-modal-select-option',o.radio=document.createElement('input'),o.radio.setAttribute('type','radio'),o.radio.setAttribute('name','tsfem-modal-select-option-group'),o.radio.tabIndex=0,o.label=document.createElement('label'),function(){for(let p in d){let q=o.wrap.cloneNode(!0),r=o.radio.cloneNode(!1),s=o.label.cloneNode(!1);r.setAttribute('value',p),s.innerHTML=d[p],0==p&&(r.checked=!0);let t='tsfem-dialog-option-'+p;r.setAttribute('id',t),s.setAttribute('for',t),q.appendChild(r),q.appendChild(s),h.selectWrap.appendChild(q)}}(),h.inner.appendChild(h.selectWrap)}h.dialog.appendChild(h.inner),(f||g)&&(h.buttonWrap=document.createElement('div'),h.buttonWrap.className='tsfem-modal-buttons',f&&(h.confirmButton=document.createElement('button'),h.confirmButton.className='tsfem-modal-confirm tsfem-button-small',h.confirmButton.className+=j?' tsfem-button-primary tsfem-button-green':' tsfem-button',h.confirmButton.innerHTML=f,h.confirmButton.addEventListener('click',function(){let o;j&&(o={detail:{checked:document.querySelector('.tsfem-modal-select input:checked').value}}),window.dispatchEvent(new CustomEvent('tsfem_modalConfirm',o))}),h.buttonWrap.appendChild(h.confirmButton)),g&&(h.cancelButton=document.createElement('button'),h.cancelButton.className='tsfem-modal-cancel tsfem-button tsfem-button-small',h.cancelButton.innerHTML=g,h.cancelButton.addEventListener('click',function(){window.dispatchEvent(new Event('tsfem_modalCancel'))}),h.buttonWrap.appendChild(h.cancelButton)),h.dialog.appendChild(h.buttonWrap)),h.dialog.appendChild(h.bottomTrap),h.dialogWrap.appendChild(h.dialog),h.container.appendChild(h.dialogWrap),document.body.appendChild(h.mask),document.body.appendChild(h.container);let k=function(){h.trap.focus()};h.trap.addEventListener('focus',k),h.bottomTrap.addEventListener('focus',k),h.trap.focus(),tsfem.fadeIn(h.mask),tsfem.fadeIn(h.container);let l=function(o){o.preventDefault()};h.maskNoScroll.addEventListener('wheel',l),h.maskNoScroll.addEventListener('touchmove',l);let m=function(){h.dialogWrap.style.marginLeft=document.getElementById('adminmenuwrap').offsetWidth+'px',h.dialogWrap.style.marginTop=document.getElementById('wpadminbar').offsetHeight+'px'};window.addEventListener('resize',m);let n=function(){h.maskNoScroll.removeEventListener('wheel',l),h.maskNoScroll.removeEventListener('touchmove',l),window.removeEventListener('tsfem_modalCancel',n),window.removeEventListener('tsfem_modalConfirm',n),window.removeEventListener('resize',m),tsfem.fadeOut(h.mask),tsfem.fadeOut(h.container)};window.addEventListener('tsfem_modalCancel',n),window.addEventListener('tsfem_modalConfirm',n)},fadeIn:function(a,b=250,c=!0){if(!(void 0===a||!a instanceof HTMLElement)&&a.style&&'opacity'in a.style){let g,h,d=0,f=0;c?h=function(){f=++d/100,a.style.opacity=f,1>f||clearInterval(g)}:(d=100,h=function(){f=--d/100,a.style.opacity=f,0<f||(clearInterval(g)||!0)&&a.remove()}),g=setInterval(h,b/100)}},fadeOut:function(a,b=300){tsfem.fadeIn(a,b,!1)},ready:function(a){a('div.updated, div.error, div.notice-warning').insertAfter('.tsfem-top-wrap'),a('a#tsfem-enable-feeds').on('click',tsfem.updateFeed),a('a.tsfem-button-extension-activate, a.tsfem-button-extension-deactivate').on('click',tsfem.updateExtension),a('a.tsfem-button-disabled').on('click',tsfem.preventDefault),a(document.body).ready(tsfem.initDescHover),a(document.body).ready(tsfem.setLastExtensionEntry),a(window).on('resize orientationchange',tsfem.setLastExtensionEntry),a(window).on('click touchend MSPointerUp',tsfem.resetSwitcher),a(document.body).ready(tsfem.setDismissNoticeListener)}},jQuery(tsfem.ready);
