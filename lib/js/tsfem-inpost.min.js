'use strict';window.tsfem_inpost=function(a){const b=tsfem_inpostL10n.post_ID,c=tsfem_inpostL10n.nonce,d=tsfem_inpostL10n.rlt,e=tsfem_inpostL10n.isPremium,f=tsfem_inpostL10n.locale,g=tsfem_inpostL10n.debug,h=tsfem_inpostL10n.i18n;let i={},j={};const k=(a,b)=>{"busy"===b?j[a]=!0:delete j[a]},l=a=>k(a,"clear"),m=a=>a in j,n=a=>a in i&&i[a]||void 0,o=a=>{i[a]&&(i[a].terminate(),l(a))},p=a=>{let b=a&&a.json||void 0,c=1===b;if(!c){let b=a;try{a=JSON.parse(a),c=!0}catch(d){c=!1,a=b}}return a};var q;const r=e=>{const f=(b,c)=>{let d=a(c),e=d.children(".tsfem-notice, .tsfem-notice-wrap .notice");1<e.length&&e.slice(0,e.length-1).each(function(){a(this).slideUp(200,function(){this.remove()})}),a(b).hide().appendTo(d).slideDown(200);let f=a(".tsfem-flex-settings-notification-area .tsfem-dismiss");const g=b=>{a(b.target).closest(".tsfem-notice").slideUp(200,function(){this.remove()})};f.off("click",g).on("click",g)},h=(e,f)=>{let h=a.Deferred(),i=f?1:0,j="";return a.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_inpost_get_dismissible_notice",post_ID:b,nonce:c,"tsfem-notice-key":e,"tsfem-notice-has-msg":i},timeout:7e3,async:!0}).done(b=>{b=p(b),g&&console.log(b);let c=b&&b.data||void 0,e=b&&b.type||void 0;if(!c||!e||"undefined"==typeof c.notice);else{let b="";i?(b=a(c.notice),d?b.find("p").first().prepend(f+" "):b.find("p").first().append(" "+f)):b=c.notice,j=b}}).fail((a,b,c)=>{g&&(console.log(a.responseText),console.log(c));let d=i?wp.template("tsfem-inpost-notice-error"):wp.template("tsfem-inpost-notice-5xx"),h=d({code:e,msg:f});j=h}).always(()=>{h.resolve(j)}),h.promise()};return{in:a=>{if(e){if(q)return void setTimeout(()=>{r(e).in(a)},500);q=!0;let b=e.type||"error",c=e.code||void 0,d=e.text||"";if(void 0===c)h(-1,d).always(b=>{f(b,a),q=!1});else if(""===d)h(c,"").always(b=>{f(b,a),q=!1});else{let g=wp.template("tsfem-inpost-notice-"+b);e=g({code:c,msg:d}),f(e,a),q=!1}}}}},s=(a,b,c)=>{g&&(console.log(a.responseText),console.log(c));let d="";switch(c){case"abort":case"timeout":d=h.TimeoutError;break;case"Bad Request":d=h.BadRequest;break;case"Internal Server Error":d=h.FatalError;break;case"parsererror":d=h.ParseError;break;default:d=h.UnknownError;}return d},t=(a,b)=>{if(a instanceof NodeList)return void a.forEach(a=>t(a,b));if(a&&!(!a instanceof Element)){["edit","loading","unknown","error","bad","warning","okay","good"].forEach(d=>{a.classList.remove("tsfem-e-inpost-icon-"+d),d===b&&a.classList.add("tsfem-e-inpost-icon-"+d)})}};var u={},v={};const w=(b,c,d,e)=>{if(!b||!b instanceof HTMLElement)return;b.style.willChange="opacity";let f=!1,g=!1;"function"==typeof d?(f=d,g=!0):"object"==typeof d&&(f="undefined"==typeof d.cb&&!1||d.cb,g="undefined"==typeof d.promise&&!0||d.promise),c=c||250,e=!(void 0!==e)||e;let h,i=0,j=0,k=10,l=b.dataset.tsfemFadeId||"_"+Math.random().toString(22).substr(2,10);b.dataset.tsfemFadeId=l,"undefined"!=typeof u[l]&&(clearInterval(u[l]),"undefined"!=typeof v[l]&&v[l].resolve()),g&&f&&(v[l]=a.Deferred(),(()=>{a.when(v[l]).done(()=>{delete v[l],f()})})(f)),e?(b.style.opacity=0,b.style.display=null,h=()=>{j=(i+=k)/100,b.style.opacity=j,1<=j&&(clearInterval(u[l]),setTimeout(()=>b.style.opacity=1,0),b.style.display=null,g?"undefined"!=typeof v[l]&&v[l].resolve():f&&f(),"none"===b.style.display&&(b.style.display=null),b.style.willChange="auto",delete b.dataset.tsfemFadeId)}):(i=100*b.style.opacity,h=()=>{j=(i-=k)/100,b.style.opacity=j,0>=j&&(clearInterval(u[l]),b.style.opacity=0,g?"undefined"!=typeof v[l]&&v[l].resolve():f&&f(),b.style.display="none",b.style.willChange="auto",delete b.dataset.tsfemFadeId)}),u[l]=setInterval(h,c*k/100)};return Object.assign({load:()=>{}},{postID:b,nonce:c,isPremium:e,locale:f,debug:g,i18n:h},{isActionableElement:a=>!(!a instanceof HTMLElement)&&(a instanceof HTMLInputElement||a instanceof HTMLSelectElement||a instanceof HTMLLabelElement||a instanceof HTMLButtonElement||a instanceof HTMLTextAreaElement),escapeStr:(a,b)=>a.length?b?a.replace(/[&<>]/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[a]):a.replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[a]):"",promiseLoop:(b,c,d,e=2e3)=>{let f=a.Deferred(),g=b.length;if(!g)return f.resolve();const h=i=>{let j,k,l;e&&(k=setTimeout(()=>{clearTimeout(j),l=setTimeout(()=>{f.reject()},250)},e)),j=setTimeout(()=>{a.when(c(b[i])).done(()=>{if(e&&(clearTimeout(k),l)){if(i<g)return;clearTimeout(l)}++i===g?f.resolve():(h(i),j=null)}).fail(()=>{f.reject()})},d)};return h(0),f.promise()},occupyWorker:a=>k(a,"busy"),freeWorker:l,isWorkerBusy:m,spawnWorker:(a,b)=>i[b]=new Worker(a),getWorker:n,stopWorker:o,despawnWorker:a=>{i[a]&&(o(a),delete i[a])},tellWorker:(b,c)=>{let d=a.Deferred();return setTimeout(()=>{let a=n(b);return a?void(a.onmessage=a=>"error"in a.data?(console.log(a.data.error),d.reject(a.data.error)):d.resolve(a.data),a.onerror=a=>(console.log(a),d.reject(a)),a.postMessage({id:b,data:c})):d.reject()}),d.promise()},doAjax:(b,c,d)=>{let f,i=d.noticeArea,j=d.premium||!1;return j&&!e?void b.reject():void(g&&console.log(c),a.ajax(c).done(a=>{b.notify(),a=p(a),g&&console.log(a);let c=a&&a.data||void 0,d=a&&a.type||void 0;if(!c||!d)return b.reject(),void(f={type:"error",code:-1,text:h.InvalidResponse});let e=c.results&&c.results.code||void 0,i=c.results&&c.results.notice||void 0,j=c.results&&c.results.type||void 0;e&&j&&(f={type:j,code:e,text:i}),"success"===d&&"data"in c?b.resolve(c.data):b.reject(e)}).fail((a,c,d)=>{b.reject(),g&&(console.log(a.responseText),console.log(d)),f={type:"error",code:-1,text:s(a,c,d)}}).always(()=>{b.notify(),f&&r(f).in(i)}))},convertJSONResponse:p,setFlexNotice:r,getAjaxError:s,setIconClass:t,fadeOut:(a,b,c)=>{w(a,b,c,!1)},fadeIn:w})}(jQuery),window.tsfem_inpost.load();
