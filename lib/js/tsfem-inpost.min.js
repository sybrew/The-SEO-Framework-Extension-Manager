'use strict';window.tsfem_inpost=function(a){const b=tsfem_inpostL10n.post_ID,c=tsfem_inpostL10n.nonce,d=tsfem_inpostL10n.rlt,e=tsfem_inpostL10n.isPremium,f=tsfem_inpostL10n.locale,g=tsfem_inpostL10n.debug,h=tsfem_inpostL10n.i18n;let i=!1,j=!1;const k=d=>{const e=(a,b)=>{const c=document.querySelector(b),d=c.querySelectorAll(".tsf-notice, .notice"),e=200,f={duration:e,iterations:1};c.style.willChange="contents",1<d.length&&(c.style.maxHeight=`${c.getBoundingClientRect().height}px`,c.style.overflow="hidden",Array.from(d).slice(0,d.length-1).forEach(a=>{a.style.transformOrigin="bottom",a.animate([{transform:"scaleY(1)",maxHeight:`${a.clientHeight}px`,opacity:1},{transform:"scaleY(0)",maxHeight:0,opacity:0}],f),setTimeout(()=>a.remove(),e)}));const g=document.createElement("template");g.innerHTML=a,c.append(g.content);const h=c.lastChild;h.style.transformOrigin="bottom",h.animate([{transform:"scaleY(0)",maxHeight:0,opacity:1},{transform:"scaleY(1)",maxHeight:`${h.clientHeight}px`,opacity:1}],f),clearTimeout(j),j=setTimeout(()=>{c.style.maxHeight=null,c.style.overflow=null},e),tsf.triggerNoticeReset()},f=(d,e)=>{let f=a.Deferred(),h=e?1:0,i="";return a.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_inpost_get_dismissible_notice",post_ID:b,nonce:c,"tsfem-notice-key":d,"tsfem-notice-has-msg":h},timeout:7e3,async:!0}).done(a=>{a=tsf.convertJSONResponse(a),g&&void 0;let b=a?.data,c=a?.type;if(!b||!c||"undefined"==typeof b.notice);else{let a=b.notice;if(h){const b=document.createElement("div");b.innerHTML=a,window.isRtl?b.querySelector("p")?.insertAdjacentHTML("beforebegin",`${e} `):b.querySelector("p")?.insertAdjacentHTML("beforeend",` ${e}`),a=b.innerHTML}i=a}}).fail(()=>{tsf.l10n.states.debug&&(void 0);let a=h?wp.template("tsfem-inpost-notice-error"):wp.template("tsfem-inpost-notice-5xx"),b=a({code:d,msg:e});i=b}).always(()=>{f.resolve(i)}),f.promise()};return{in:a=>{if(d){if(i)return void setTimeout(()=>{k(d).in(a)},500);i=!0;let b=d.type||"error",c=d.code||void 0,g=d.text||"";if(void 0===c)f(-1,g).always(b=>{e(b,a),i=!1});else if(""===g)f(c,"").always(b=>{e(b,a),i=!1});else{const d=wp.template(`tsfem-inpost-notice-${b}`);e(d({code:c,msg:g}),a),i=!1}}}}},l=(a,b,c)=>{tsf.l10n.states.debug&&(void 0,void 0);let d="";switch(c){case"abort":case"timeout":d=h.TimeoutError;break;case"Bad Request":d=h.BadRequest;break;case"Internal Server Error":d=h.FatalError;break;case"parsererror":d=h.ParseError;break;default:d=h.UnknownError;}return d},m=(a,b)=>{if(a instanceof NodeList)return void a.forEach(a=>m(a,b));if(a&&!(!a instanceof Element)){["edit","loading","unknown","error","bad","warning","okay","good"].forEach(d=>{a.classList.remove(`tsfem-e-inpost-icon-${d}`),d===b&&a.classList.add(`tsfem-e-inpost-icon-${d}`)})}};var n={},o={};const p=(a,b,c,d)=>{var e=Number.parseFloat;if(!a||!a instanceof HTMLElement)return;a.style.willChange="opacity";let f=!1,g=!1;"function"==typeof c?(f=c,g=!0):"object"==typeof c&&(f=c?.cb||!1,g=c?.promise||!1),b||=250,d=!(void 0!==d)||d;let h,i,j,k=a.dataset.tsfemFadeId||"_"+Math.random().toString(22).substring(2,10)+Math.random().toString(22).substring(2,10),l=0;a.dataset.tsfemFadeId=k,"undefined"!=typeof n[k]&&(cancelAnimationFrame(n[k].frame),"show"===n[k].type?(a.style.opacity=1,a.style.display=null):(a.style.opacity=0,a.style.display="none"),delete n[k],"undefined"!=typeof o[k]&&o[k].resolve(),delete o[k]),g&&f&&(o[k]=new Promise,(()=>{o[k].then(()=>{delete o[k],f()})})(f)),n[k]={type:d?"show":"hide",frame:void 0},d?(a.style.display=null,a.style.opacity=0,h=c=>{i=void 0===i?c:i,j=(c-i)/b,l=+e(j).toPrecision(3),a.style.opacity=l,1<=l?(cancelAnimationFrame(n[k].frame),a.style.opacity=1,a.style.display=null,a.style.willChange="auto",delete a.dataset.tsfemFadeId,delete n[k],g?o?.[k].resolve():f&&f()):n[k].frame=requestAnimationFrame(h)}):(a.style.display=null,a.style.opacity=1,h=c=>{i=void 0===i?c:i,j=(c-i)/b,l=+e(1-j).toPrecision(3),a.style.opacity=l,a.style.display=null,0>=l?(cancelAnimationFrame(n[k].frame),a.style.opacity=0,a.style.display="none",a.style.willChange="auto",delete a.dataset.tsfemFadeId,delete n[k],g?o?.[k].resolve():f&&f()):n[k].frame=requestAnimationFrame(h)}),n[k].frame=requestAnimationFrame(h)};return Object.assign({load:()=>{}},{postID:b,nonce:c,isPremium:e,locale:f,debug:g,i18n:h},{isActionableElement:a=>!(!a instanceof HTMLElement)&&(a instanceof HTMLInputElement||a instanceof HTMLSelectElement||a instanceof HTMLLabelElement||a instanceof HTMLButtonElement||a instanceof HTMLTextAreaElement),escapeStr:(a,b)=>a.length?b?a.replace(/[&<>]/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[a]):a.replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[a]):"",promiseLoop:(a,b,c,d=2e3)=>new Promise((e,f)=>{let g=a.length;if(!g)return e();const h=i=>{let j,k,l;d&&(k=setTimeout(()=>{clearTimeout(j),l=setTimeout(()=>{f()},250)},d)),j=setTimeout(()=>new Promise(async(c,d)=>{try{await b(a[i]),c()}catch(a){d()}}).then(()=>{if(d&&(clearTimeout(k),l)){if(i<g)return;clearTimeout(l)}++i===g?e():(j=null,h(i))}).catch(()=>{f()}),c)};h(0)}),doAjax:(b,c)=>new Promise((d,f)=>{let i,j=c.noticeArea,m=c.premium||!1;return m&&!e?f():void(g&&void 0,a.ajax(b).done(a=>{a=tsf.convertJSONResponse(a),g&&void 0;let b=a?.data,c=a?.type;if(!b||!c)return i={type:"error",code:-1,text:h.InvalidResponse},void f();let e=b?.results?.code,j=b?.results?.notice,k=b?.results?.type;e&&k&&(i={type:k,code:e,text:j}),"success"===c&&"data"in b?d(b.data):f(e)}).fail((a,b,c)=>{tsf.l10n.states.debug&&(void 0,void 0),i={type:"error",code:-1,text:l(a,b,c)},f()}).always(()=>{i&&k(i).in(j)}))}),setFlexNotice:k,getAjaxError:l,setIconClass:m,fadeOut:(a,b,c)=>{p(a,b,c,!1)},fadeIn:p,debounce:(a,b=0)=>{let c=0;return()=>(clearTimeout(c),{timeoutId:c=setTimeout(a,b),cancel:()=>clearTimeout(c)})}})}(jQuery),window.tsfem_inpost.load();
