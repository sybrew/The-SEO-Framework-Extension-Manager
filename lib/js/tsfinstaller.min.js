'use strict';window.tsfinstaller=function(a,b){const c=a(document),{__:d,_x:e,sprintf:f}=b.i18n,g=g=>{let h=a(`[data-slug="${g?.slug}"]`);h.removeClass("install-now installed button-disabled updating-message").addClass("activate-now").attr({href:g.activateUrl+"&from=plugins","aria-label":f("plugins-network"===pagenow?e("Network Activate %s","plugin"):e("Activate %s","plugin"),g.pluginName)}).text("plugins-network"===pagenow?d("Network Activate"):d("Activate"));let i=h.clone()[0].outerHTML;b.updates.addAdminNotice({id:"install-success",className:"notice-success is-dismissible",message:d("Installation completed successfully.")+" "+i}),b.a11y.speak(d("Installation completed successfully.")),c.trigger("tsfem-tsf-install-success",g)},h=g=>{let h=f(d("Installation failed: %s"),g.errorMessage),i=a(`[data-slug="${g?.slug}"]`),j=i.data("name");!b.updates.isValidResponse(g,"install")||b.updates.maybeHandleCredentialError(g,"install-plugin")||(b.updates.addAdminNotice({id:g.errorCode,className:"notice-error is-dismissible",message:h}),i.removeClass("updating-message").attr("aria-label",f(e("Install %s now","plugin"),j)).text(d("Install Now")),b.a11y.speak(h,"assertive"),c.trigger("tsfem-tsf-install-error",g))},i=()=>{if(!b||!b.updates)return;let i=b.updates._addCallbacks;a("#plugin_install_from_iframe").on("click",function(b){let c,d=window.parent===window?null:window.parent;-1!==window.parent.location.pathname.indexOf("index.php")&&a(this).data("slug")===tsfinstallerL10n.slug&&(a.support.postMessage=!!window.postMessage,!1===a.support.postMessage||null===d||(b.preventDefault(),c={action:"install-plugin",data:{slug:a(this).data("slug")}},d.postMessage(JSON.stringify(c),window.location.origin)))}),a("#tsfem-tsf-tb").on("click",()=>{let j=!1;b.updates._addCallbacks=(b,c)=>("install-plugin"===c&&tsfinstallerL10n.slug===b.slug&&(b.success=g,b.error=h,a(`[data-slug="${b.slug}"]`).addClass("updating-message").attr("aria-label",f(e("Installing %s...","plugin"),$button.data("name"))).text(d("Installing...")),j=!0),b),a(window).on("message",a=>{let b;try{b=JSON.parse(a.originalEvent.data)}catch(a){return}b&&"undefined"!=typeof b.action&&("install-plugin"===b.action?j=!1:j=!0)});let k,l;const m=()=>{b.updates._addCallbacks=i,clearInterval(k),c.off(l,m)},n=()=>{j&&m()};l="wp-plugin-installing wp-plugin-install-error wp-plugin-install-success",a("body").one("thickbox:removed",()=>{k=setInterval(n,100),setTimeout(m,750)}),c.one(l,m)}),c.on("click","#tsfem-tsf-install",i=>{let j=a(i.target);j.hasClass("activate-now")||(i.preventDefault(),j.hasClass("updating-message")||j.hasClass("button-disabled")||(j.html()!==d("Installing...")&&j.data("originaltext",j.html()),j.addClass("updating-message").attr("aria-label",f(e("Installing %s...","plugin"),j.data("name"))).text(d("Installing...")),b.updates.shouldRequestFilesystemCredentials&&!b.updates.ajaxLocked&&(b.updates.requestFilesystemCredentials(i),c.on("credential-modal-cancel",()=>{j.removeClass("updating-message").attr("aria-label",f(e("Install %s now","plugin"),pluginName)).text(d("Install Now")),b.a11y.speak(d("Update canceled."))})),b.updates.installPlugin({slug:j.data("slug"),pagenow:pagenow,success:g,error:h})))})};return{load:()=>{a(i)}}}(jQuery,window.wp),window.tsfinstaller.load();
